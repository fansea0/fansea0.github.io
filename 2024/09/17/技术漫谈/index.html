<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>技术漫谈 | FANSEA</title><meta name="keywords" content="技术漫谈"><meta name="author" content="FANSEA"><meta name="copyright" content="FANSEA"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="技术漫谈"><meta name="application-name" content="技术漫谈"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="技术漫谈"><meta property="og:url" content="https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/index.html"><meta property="og:site_name" content="FANSEA"><meta property="og:description" content="技术漫谈如何解决订单一致性问题 Lua + RocketMq事务消息  Lua：保障原子性，相比Java事务响应更加快捷 RocketMq：保障消息发送环节的事务性   事务消息 | RocketMQ (apache.org)  XA协议 原理：将四个调用分支封装成包含四个独立事务分支的大事务 特点"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://fansea0.github.io/fansea.png"><meta property="article:author" content="FANSEA"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://fansea0.github.io/fansea.png"><meta name="description" content="技术漫谈如何解决订单一致性问题 Lua + RocketMq事务消息  Lua：保障原子性，相比Java事务响应更加快捷 RocketMq：保障消息发送环节的事务性   事务消息 | RocketMQ (apache.org)  XA协议 原理：将四个调用分支封装成包含四个独立事务分支的大事务 特点"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: FANSEA","link":"链接: ","source":"来源: FANSEA","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'FANSEA',
  title: '技术漫谈',
  postAI: '',
  pageFillDescription: '技术漫谈, 如何解决订单一致性问题, XA协议, 普通消息+订单事务, RocketMQ事务消息, 使用实例, 步骤 1 创建事务生产者, 步骤 2 处理事务状态检查, Jenkins, 实时数据更新, SSE, 短轮询, 长轮询, WebSocket, JWT登录, JWT（JSON Web Token）定义, JWT的优点, JWT的结构原理, 代码实现, 程序设计六大设计原则, 依赖倒置原则, 示例背景, 传统方式, 应用依赖倒置原则, 接口隔离原则, 示例背景, 问题描述, 应用 ISP 的解决方案, 迪米特法则, 示例背景, 违反迪米特法则的示例, 应用迪米特法则的示例, 保障缓存和数据库一致性, 方法一：延迟双删, 方法二：更新数据库再删缓存, ThreadLocal使用原理, 原理, 使用, 思考, 软件开发模型, 1. 瀑布模型 (Waterfall Model), 2. 增量模型 (Incremental Model), 3. 螺旋模型 (Spiral Model), 分布式理论, CAP 定理的选择示例：, UML图, UML 的主要用途：, UML 图的主要类型：, UML 的优势：, 拦截器与过滤器, 区别, 过滤器(Filter), 拦截器(Interceptor), 使用场景, 示例, 过滤器示例, 拦截器示例, Spring异步流式接口, ResponseBodyEmitter, SseEmitter, StreamingResponseBody, Java的NIO详解, BIO有什么缺点？, 如何优化BIO？, NIO的优化点, NIO使用样例, CRM系统, 性能指标参数, 吞吐量衡量单位（x2Fs）, 接口限流, 如何设计一个高并发处理系统, 后台快速开发框架, , 库存管理技术漫谈如何解决订单一致性问题事务消息保障原子性相比事务响应更加快捷保障消息发送环节的事务性事务消息协议原理将四个调用分支封装成包含四个独立事务分支的大事务特点多分支环境下资源锁定范围大并发度低随着下游分支的增加系统性能会越来越差普通消息订单事务原理基于异步实现事务同步特点并发量大无法保证最终一致性该方案中消息下游分支和订单系统变更的主分支很容易出现不一致的现象例如消息发送成功订单没有执行成功需要回滚整个事务订单执行成功消息没有发送成功需要额外补偿才能发现不一致消息发送超时未知此时无法判断需要回滚订单还是提交订单变更事务消息用于分布式服务间的最终一致性将消息发送和主事务绑定解决了普通消息主事务的结果不一致的问题上述普通消息方案中普通消息和订单事务无法保证一致的原因本质上是由于普通消息无法像单机数据库事务一样具备提交回滚和统一协调的能力而基于实现的分布式事务消息功能在普通消息基础上支持二阶段的提交能力将二阶段提交和本地事务绑定实现全局提交结果的一致性原理普通消息订单事务的基础上对消息发送这个步骤增加事务事务消息具备提交回滚和统一协调的能力特点保证并发的同时并且保证最终一致性使用实例是一款分布式消息中间件它支持多种消息模式包括事务消息事务消息主要用于确保本地事务和消息发送的一致性下面是一个使用实现事务消息的基本示例首先你需要确保你的环境中已经安装了的和并且正确配置了环境步骤创建事务生产者首先你需要创建一个实例并设置一个方法来处理本地事务实例化消息生产者设置的地址执行本地事务这里处理本地事务逻辑本地事务成功需要回滚启动实例创建一条消息对象这里为消息内容为用户指定的标签为消息主题发送消息参数为如果不是状态则不需要回调检查等待的二次确认步骤处理事务状态检查的会异步地回调方法来确认消息的状态如果本地事务状态未知将会调用这个方法来确认消息是否应该提交还是回滚这里根据的属性来决定是否提交或回滚消息本地事务成功请注意上述示例代码仅为示意性的实际使用时需要根据具体的业务逻辑实现和方法此外还需要确保的启动和关闭逻辑正确处理在实际部署时请替换为你的地址并确保名称唯一且符合你的命名规则官网自动集成多插件满足多种编译需求支持远程在服务器部署程序配合实现快速编译定义任务远程启动分布式实时数据更新特点只支持单向通信不能发送二进制数据只能发送的数据短轮询不断轮询服务器来获取最新数据长轮询一个请求打到服务器如果数据没有更新连接会被挂起住等待如果更新了就返回更新数据如果数据更新了就直接返回用途消息实时性要求高数据更新频率不快特点实时性由于的持久化连接它可以实现实时的数据传输避免了应用程序需要不断地发送请求以获取最新数据的情况双向通信协议支持双向通信这意味着服务器可以主动向客户端发送数据而不需要客户端发送请求减少网络负载由于的持久化连接它可以减少请求的数量从而减少了网络负载使用场景在线聊天登录定义是一种用于在网络应用间安全地传输信息的标准它是一种轻量级的开放标准用于在各方之间以安全的方式传输信息通常用于身份验证和服务之间传递授权信息由三部分组成头部负载以及签名这三部分通过点号连接的优点无状态包含所有用户认证信息因此不需要存储在服务器端使得其成为无状态的可以跨域使用紧凑性是紧凑且自包含的使得它可以通过参数或者在中轻松传送缓存友好因为是无状态的所以可以被浏览器缓存而不会带来任何安全隐患支持多种加密算法支持算法或公私钥对进行签名易于扩展可以在中加入任何可序列化为的信息的结构原理由以下三部分组成头部头部通常包含了令牌的类型和所使用的签名算法例如负载负载包含了需要传递的信息这部分是的核心也是应用程序想要声明的所有相关信息所在的地方例如表示主体通常是用户表示用户的名字是签发时间时间戳格式签名因为签名的创建是经过负载的所以在负载内容被篡改时这会在解析时发现签名一定会和负载不对应导致失效签名用于验证消息发送者的真实性并且确保消息没有被篡改它是通过指定的算法如结合以及一个密钥计算出来的字符串例如整个就是将这三部分用连接起来的一个字符串例如这个字符串分为三个部分头部负载签名创建解析代码实现创建令牌根据将缓存解析令牌获取请求携带的令牌解析对应的权限以及用户信息获取用户信息异常程序设计六大设计原则在软件工程中有多个设计原则用于指导开发者编写可维护可扩展健壮的代码虽然不同文献和实践者可能会有所差异但通常提到的六大设计原则指的是面向对象设计的原则这些原则有助于避免代码僵化脆弱难以理解等问题使软件系统更加灵活易于维护和扩展程序设计的六大原则必要性一者在团队协作下编写可读性代码尤为重要二来方便代码扩展以下是原则的具体内容单一职责原则每个类应该只有一个改变的理由这意味着一个类应该只负责一项功能这样当需求变化时只需修改一个类即可开放封闭原则软件实体类模块函数等应该是可扩展的但不可修改的也就是说可以通过添加新的代码来扩展一个模块的功能而不应当修改已有的代码里氏替换原则子类必须能够替换掉它们的基类简单来说就是任何可以使用父类的地方也应该能够使用子类而不会导致错误接口隔离原则使用者不应该被强迫依赖于它们不使用的方法也就是说应该将接口设计得足够具体使得实现类不需要实现不相关的功能依赖倒置原则高层模块不应该依赖于低层模块二者都应该依赖于抽象抽象不应该依赖于细节细节应该依赖于抽象依赖于抽象便于未来扩展新功能迪米特法则有时也被认为是一个设计原则它指出一个对象应该对其它对象有最少的了解即一个对象应当对其它对象有尽可能少的引用这样可以降低对象之间的耦合度依赖倒置原则依赖倒置原则强调高层模块不应该依赖于低层模块二者都应该依赖于抽象抽象不应该依赖于细节细节应该依赖于抽象通俗地说就是鼓励我们通过接口或抽象类来编程而不是针对具体的实现类编程为了更好地理解依赖倒置原则让我们来看一个简单的例子示例背景假设我们需要开发一个系统其中包括一个用户界面和一个数据处理逻辑用户界面需要显示一些数据而数据处理逻辑负责获取数据并进行处理传统方式传统的方式可能是这样的模拟从网络获取数据在这个例子中类直接依赖于类这种方式的问题是如果发生了变化那么也需要随之改变此外如果我们想要测试类就必须有一个实际的实例这增加了测试的难度应用依赖倒置原则现在我们应用依赖倒置原则将具体的实现转为依赖抽象定义一个接口或抽象类表示数据获取的行为高层模块依赖这个接口而不是具体的实现低层模块实现这个接口下面是改进后的代码示例定义一个数据获取行为的接口具体的数据获取实现模拟从网络获取数据模拟从文件读取数据通过构造函数传递依赖在这个例子中类依赖于接口而具体的实现类如或则实现了这个接口这种设计的好处是类不关心具体的数据来源只需要知道如何获取数据如果需要更改数据源只需要更换的实现类测试变得更加容易可以通过构造函数传递一个模拟的实现来进行单元测试通过这个例子可以看出依赖倒置原则通过依赖抽象减少了各个组件间的耦合性提高了系统的灵活性和可测试性接口隔离原则接口隔离原则提倡的是不应该强迫类去实现它们不需要的方法换句话说一个类不应该被迫实现它不会使用的所有接口方法主张将胖接口拆分成更细粒度的接口以便实现类只需要实现它们真正关心的部分下面通过一个简单的示例来说明接口隔离原则的重要性及其应用示例背景假设我们正在开发一个游戏系统其中包含动物和飞行器两种类型的对象每种对象都有它们独特的功能问题描述在没有应用的情况下我们可能会有这样的设计飞行能力游泳能力在这个设计中类并不支持飞行和游泳但是由于接口中定义了这些方法所以类必须实现它们即使类在实现这些方法时仅仅打印出不支持的消息这也违反了的精神应用的解决方案按照的原则我们应该将接口拆分为更具体的接口让类只实现它们实际需要的方法在这个改进的设计中类只需要实现接口类实现了和接口类实现了和接口这样每种类型的对象都只实现了它们实际需要的方法从而避免了不必要的方法实现提高了代码的清晰度和可维护性迪米特法则一个类方法调用另外一个类的逻辑应该对其他实体有最少的了解这样可以减少耦合性迪米特法则又称为最少知识原则主张一个软件实体如类模块函数等应该对其他实体有最少的了解这意味着一个对象应该尽可能减少与其他对象的交互仅与它的朋友通信朋友一般是指当前对象的成员变量参数返回的对象等应用迪米特法则可以减少对象之间的耦合度提高系统的灵活性和可维护性示例背景假设我们有一个学校管理系统需要处理学生课程和成绩的关系具体来说我们需要一个功能来计算学生的总成绩违反迪米特法则的示例首先我们看看违反迪米特法则的情况直接访问内部的在这个例子中类直接访问了类的内部状态并且还调用了类的方法这样做的问题是类与类和类耦合得太紧不利于系统的扩展和维护应用迪米特法则的示例接下来我们来看看如何通过迪米特法则来优化上述设计通过的来获取总分数内部处理计算逻辑在这个改进的设计中类不再直接访问类的内部状态类通过调用类的方法来获得总分数类封装了与其内部的交互逻辑通过这种方式类仅需知道类提供的公共方法而不需要了解其内部结构这就降低了类与类之间的耦合度保障缓存和数据库一致性执行数据更新操作时就会出现缓存和数据库的一致性问题方法一延迟双删更新时先把缓存删除并在数据保存在数据库后延时一点时间再把缓存删除保障最终一致性第一次删除保障更新完数据后这个时候的访问能拿到最新数据缓存到而不至于访问到旧的数据虽然最后这个存在的的最后会被延时删除但是确实保障了这更新期间的一致性如果没有后面这一步的删除很可能并发情况下其他线程查询数据将旧数据继续缓存到了而至于为什么要设置一个延时时间可以设定可以接受的不一致的时间方法二更新数据库再删缓存引入避免删除操作万一失败而导致的缓存一致性的问题重试机制使用原理原理由于是为所以一个类只能保存一个数据不同的保存不同的信息内部包含这是线程间数据隔离的关键为什么要使用弱引用确保当实例不再被外部强引用时可以被垃圾回收器回收在这样的情况下由于仍然有指向它所以不会被回收掉但是此时的又为所以我们无法访问到这个这就导致了这个我们即不能访问到也不能进行回收此时就造成了的内存泄漏使用声明保存用户上下文信息定义方法对进行增删查拦截对应请求通过方法去存取用户信息记得最终要释放掉空间黑马点评项目中我们将用户信息保存在每一个请求线程中这样我们只需要在拦截器中获取用户信息无需继续访问数据库存在存入中刷新过期时间放行销毁数据防止用户信息泄露思考为什么会有内存泄漏的风险使用的弱引用作为如果一个不存在外部强引用时势必会被回收这样就会导致中为而还存在着强引用只有线程退出以后的强引用链条才会断掉但如果当前线程再迟迟不结束的话这些为的的就会一直存在一条强引用链永远无法回收造成内存泄漏为什么中的的要声明为在线程池中一个线程会不断的从队列中拿去任务执行不发生异常的话这个线程是会一直存活的换句话说他的一直都在如果此时作为方法里的局部变量且的不声明为弱引用则为硬引用方法跑完被回收但是线程不会结束因为是线程池的线程不会被回收对应上一步的生成的还是保留在的数组中只要不死就还在就无法回收那个然后不为已经没办法判断是不是回收的了还是讨论作为方法里的局部变量且的声明为弱引用方法跑完被回收但是线程不会结束因为是线程池的线程不会被回收对应上一步的生成的还是保留在的数组中等待某次后的被回收变成在源码中有对的进行的的操作在某次调用还能再补救一下相比为硬引用已经没办法补救了已经识别不出来哪些是正在需要的了总结来说在为局部变量的时候不声明为忘记了然后被回收后再也没办法确认这个认为是用完的节点是不是可以了而弱引用的的某次后无用的都被标记为此时就能识别出来是泄露的内存使用方式计算当前变量所在数组位置再次循环判断是否在为变量所在数组位置调用的方法清除对的弱引用清理为的元素这样的话无论是还是只要是被回收了指向都会被一次性掉软件开发模型在软件工程中开发模型是用来规划和组织软件开发过程的一组实践和技术以下是三种常见的软件开发模型瀑布模型增量模型和螺旋模型瀑布模型瀑布模型是最传统的软件开发过程模型之一它将软件开发过程划分为一系列阶段每个阶段必须在前一个阶段完成后才能开始这些阶段通常包括需求分析设计编码测试和维护特点阶段性每个阶段必须完成一定的任务然后才能进入下一个阶段单向流动一旦进入下一阶段很难返回上一阶段进行修改文档化每个阶段结束时都需要产生详细的文档优点结构清晰便于管理和控制易于理解适合小型项目或需求非常明确的项目缺点缺乏灵活性一旦进入后期阶段很难回到早期阶段进行修改不适合需求不明确或需求频繁变更的项目用户参与度较低直到后期才能看到实际的产品增量模型增量模型是瀑布模型的一种改进它允许在开发过程中逐步交付产品的各个部分或功能模块特点分批次开发将软件开发分解成一系列的增量构建每次构建都会交付一部分功能迭代每次增量构建都可以基于之前的反馈进行调整优点提高了项目的灵活性可以在早期阶段就获得用户反馈减少了项目的总体风险因为每次只关注一小部分功能更好地适应需求变化缺点管理多个增量版本可能较为复杂需要较好的计划和协调能力螺旋模型螺旋模型结合了瀑布模型的阶段性和原型模型的迭代性特别适用于大型复杂系统的开发特点迭代循环每个周期包含四个主要阶段制定计划风险评估工程实施客户评估风险驱动在每个周期开始时都要进行风险评估以确定是否继续当前的开发路径逐步深入随着项目的进展逐步细化需求和解决方案优点能够更好地处理风险因为每个阶段都包含了风险评估更加灵活允许在项目早期就发现并解决问题用户参与度高每个迭代周期结束后都会有用户评审缺点相对于简单的瀑布模型管理成本更高对于小规模项目来说可能过于复杂需要有经验丰富的项目经理来指导风险评估每种模型都有其适用的场景选择哪种模型取决于项目的具体情况团队的经验以及客户的需求在实际应用中很多团队会根据项目的特点混合使用多种模型的特点分布式理论理论也称为布鲁尔定理是由加州大学伯克利分校的计算机科学家埃里克布鲁尔在年提出的这一理论阐述了分布式系统设计中一致性和可用性之间的权衡在理论中分布式系统的设计必须在以下三个属性中至少放弃一个一致性所有节点在同一时刻看到相同的数据一次更新操作后所有节点要么都显示新数据要么都显示旧数据不会出现部分节点显示旧数据部分节点显示新数据的情况更新操作后系统处于一致状态可用性每个请求无论是否最终成功或失败都能在合理的时间内收到响应系统能够保证非故障节点的请求都能得到响应即使有部分节点发生故障系统仍然能够继续工作分区容错性网络分区网络的一部分节点无法与其他节点通信发生时系统仍然能够正常运作即便网络中存在信息丢失或延迟的情况系统也能继续运作理论指出在分布式系统中无法同时保证这三个属性因此设计者必须在和之间做出选择通常情况下系统会选择分区容错性因为网络分区是一个不可避免的事实特别是在互联网环境中因此设计者需要在一致性和可用性之间做出权衡定理的选择示例模型当系统没有分区时保证一致性和可用性例如传统的事务数据库模型在存在分区的情况下优先保证一致性和分区容错性可能会牺牲部分可用性例如某些键值存储系统如在强一致模式下模型在存在分区的情况下优先保证可用性和分区容错性可能会牺牲一致性例如大多数数据库如在多数情况下分布式缓存系统等在实践中很多分布式系统会采用混合策略即在不同的操作或不同的数据类型上采用不同的选择以达到性能和一致性的平衡此外一些系统还会使用最终一致性的概念即在一段时间后所有的数据副本都会达到一致的状态而不是立即一致这样可以在一定程度上兼顾可用性和一致性图统一建模语言是一种标准化的通用图形化建模语言用于软件工程领域它提供了一套符号体系使得软件工程师能够以图形化的方式描述可视化构造以及记录软件系统的设计是由和在世纪年代初开发的并在年由标准化的主要用途描述系统结构描述系统的静态结构包括类接口对象以及它们之间的关系描述系统行为描述系统的动态行为如交互活动状态转换等支持整个软件开发生命周期从需求分析到系统维护支持软件开发的各个阶段图的主要类型类图用于描述系统的静态结构包括类接口类的关系如继承聚合组合等对象图展示类实例对象及其相互关系组件图描述系统中的物理构件如库可执行文件源代码文件等以及它们之间的依赖关系部署图描述系统的硬件架构以及软件构件在硬件上的分布情况时序图描述对象之间如何交互以完成特定的用例或功能强调时间顺序协作图也称作通信图展示对象之间的交互但更注重参与者之间的关系活动图描述系统的活动流程类似于流程图但可以表示并发活动状态机图或描述对象在其生命周期中的状态变化以及导致这些变化的事件用例图描述系统功能用例以及与系统交互的外部参与者包图描述系统中逻辑模块包及其依赖关系的优势统一性提供了一套标准的符号体系使得不同的开发人员可以共享设计信息可读性图形化的表示方式使得设计更加直观易懂工具支持有许多工具支持如的等是一个强大的工具它帮助软件工程师在设计阶段就识别出潜在的问题并促进团队成员之间的沟通虽然本身并不能编写代码但它可以帮助团队更好地理解和实现软件系统拦截器与过滤器区别在开发中框架提供了两种机制来处理请求之前的逻辑或请求之后的逻辑过滤器和拦截器虽然它们都可以用来处理一些预处理或后处理的任务但是它们的使用场景和实现方式有所不同过滤器过滤器是规范的一部分因此它不仅限于使用过滤器通常用于跨多个或页面的功能如编码处理登录验证权限检查等生命周期过滤器的生命周期由容器管理可以对请求进行预处理在响应返回客户端之前进行后处理配置过滤器是通过文件或者使用配置类中的注解来配置的执行顺序过滤器按照在中的声明顺序执行使用接口实现拦截器拦截器是框架特有的组件主要用于拦截用户请求并做相应的处理拦截器主要用于业务操作前后的处理如记录日志性能监控事务处理异常处理等生命周期拦截器的生命周期由管理配置拦截器是通过在的配置类中通过方法来配置的执行顺序拦截器的执行顺序取决于你在配置类中定义的顺序实现接口或继承类使用场景过滤器更适合于做一些通用的功能比如统一设置字符编码增加响应头信息安全控制等偏向于对请求的基础处理拦截器适合于做一些业务相关的处理比如权限校验记录日志等更偏向于业务示例过滤器示例首先创建一个过滤器类初始化代码在请求进入之前处理调用下一个过滤器或者最终的目标资源在请求返回给客户端之后处理销毁代码然后在中配置这个过滤器拦截器示例创建一个拦截器类在调用控制器方法之前执行检查中是否有用户信息如果没有则重定向到登录页面返回则继续向下执行否则结束在调用控制器方法之后执行但在视图渲染之前在整个请求完成后执行包括视图渲染接着在配置类中注册这个拦截器注册拦截器拦截所有请求排除和路径以上就是过滤器和拦截器的基本使用示例实际应用中可以根据需求调整代码逻辑和配置异步流式接口异步流式接口详解及使用使用来实现下这个效果创建发送器对象模拟耗时操作逐步调用方法发送消息创建一个代表不超时异步执行耗时操作模拟耗时操作发送数据完成发生异常时结束接口是的一个子类它同样能够实现动态内容生成不过主要将它用在服务器向客户端推送实时数据如实时消息推送状态更新等场景与其他响应处理方式略有不同主要用于处理大数据量或持续数据流的传输支持将数据直接写入的详解详解是之后对缺点提出的一种替换方案为适用场景需要处理大量并发连接的场景实时数据处理搭建高性能服务器有什么缺点通常是对每个连接开辟一个线程去处理事件如果没监听到数据将会一直阻塞线程的创建销毁都需要重量级的操作多线程之间的并发会带来线程切换的消耗因为要保存线程的上下文信息线程本身占用较大内存像的线程的栈内存一般至少分配的空间如果系统中的线程数过千整个的内存将被耗用如何优化现实开发中通常用的最多的也是为了避免过高并发带来的多线程性能降低常常会使用线程池来处理任务但这并不能解决阻塞问题万一连接了而不发送数据那还是会占用没必要的线程资源的优化点结构包括管道选择器缓冲区管道监听某一个端口的连接与可以理解为当前端口收到了多少个连接就是多少个管道选择器监听每个管道的事件通过阻塞轮询定位到有数据发送的管道缓冲区缓存读写数据通过管道搭配选择器可以实现多路复用一个线程监听多个连接且这是非阻塞的只有当有数据发送过来才会执行读取逻辑期间可以利用该线程去做其他的事优化点多路复用减少线程消耗最大程度利用好一个线程的资源非阻塞的操作是阻塞的当一个线程调用或时该线程被阻塞直到有一些数据被读取或数据完全写入该线程在此期间不能再干任何事情了例如我们调用一个方法读取一个文件的内容那么调用的线程会被阻塞住直到操作完成如何做到非阻塞的呢当我们调用方法时系统底层已经把数据准备好了应用程序只需要从通道把数据复制到缓冲区就行如果没有数据当前线程可以去干别的事情不需要进行阻塞等待监听事件将事件进行了简化只定义了四个事件这四种事件用的四个常量来表示使用样例创建创建并绑定到指定端口注册到上监听事件选择一组已经就绪的通道获取已选择的键集处理事件读状态将管道的数据写到缓冲区之后再执行读操作先写再读处理事件客户端关闭连接将缓冲区切换到读模式回应客户端切换回写状态移除已处理的键系统面向客户作用企业总的来说就是通过对客户的信息管理分析从而制定个性化营销方案更好的满足客户需求客户关系管理客户关系管理是指用于管理客户关系的全方位软件系统而不是一个单独的解决方案为了有效地管理分析和改善客户关系您需要一整套全面的云技术解决方案来帮助企业处理每一个客户交互点系统可收集关联和分析所有相关客户数据包括联系人信息与企业销售代表的互动信息历史购买记录服务请求资产和报价提议等然后用户可访问这些数据并了解每个接触点的最新动态并据此创建完整的客户档案进而建立牢固的客户关系性能指标参数吞吐量衡量单位每秒查询数每秒查询率每秒请求数在服务和接口中吞吐量通常表示为每秒钟能够处理的请求数每秒事务数在数据库和金融系统中吞吐量通常表示为每秒钟能够处理的事务数每秒消息数在消息队列和消息传递系统中吞吐量通常表示为每秒钟能够处理的消息数每秒字节数在网络传输和文件传输中吞吐量通常表示为每秒钟能够传输的数据量接口限流如何设计一个高并发处理系统系统拆分拆分服务并把服务部署集群通过负载均衡对流量进行分发缓存加速缓存热点数据减少数据库的直接读取异步削峰异步处理加快响应时间削峰填谷消费者可以灵活调节发现业务请求多了可以多添加实例少了可以减少数据分离分库分表垂直分库减少连接数水平分表减少数据库大表拆成小表数据减少加快索引查询读写分离读写互斥会降低可用性将数据读写分离保障最终一致性的同时加快响应时间适合读多写少的场景服务监控监控服务状态快速定位服务问题很适合做日志的消息队列后台快速开发框架若依适用于国企政府类项目基于打造简洁高效的开发体验国产加解密技术国家三级等保电脑如何启动库存管理智能化协同化数字化与供应商信息共享获取最新的产品生产计划灵活调整补货策略大数据分析未来需求全国仓储网络多仓协同缺货可以迅速从其他地区调拨库存同时减低库存压力线上与线下融合增快供货速率提升用户体验',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-14 21:29:29',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">FANSEA</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>1</sup></a><a href="/tags/MQ/" style="font-size: 1.05rem;">MQ<sup>1</sup></a><a href="/tags/NoSQL/" style="font-size: 1.05rem;">NoSQL<sup>2</sup></a><a href="/tags/ROS/" style="font-size: 1.05rem;">ROS<sup>1</sup></a><a href="/tags/cursor-%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">cursor 前端<sup>1</sup></a><a href="/tags/docker-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">docker 微服务<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>8</sup></a><a href="/tags/rag-%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D-SpringAI-%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/" style="font-size: 1.05rem;">rag 智能客服 SpringAI 毕业设计<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 1.05rem;">创业<sup>1</sup></a><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">微服务<sup>4</sup></a><a href="/tags/%E6%80%9D%E8%80%83/" style="font-size: 1.05rem;">思考<sup>10</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 1.05rem;">技术<sup>1</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/" style="font-size: 1.05rem;">技术漫谈<sup>21</sup></a><a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 1.05rem;">摄影<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>6</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>7</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7-JMeter/" style="font-size: 1.05rem;">编程工具 JMeter<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">计算机基础<sup>4</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8E%A7%E5%88%B6/" style="font-size: 1.05rem;">计算机控制<sup>1</sup></a><a href="/tags/%E8%BD%A6%E8%BD%A6/" style="font-size: 1.05rem;">车车<sup>1</sup></a><a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 1.05rem;">金融<sup>2</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 1.05rem;">项目<sup>11</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>技术漫谈</span></a></span></div></div><h1 class="post-title" itemprop="name headline">技术漫谈</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-09-17T07:03:23.000Z" title="发表于 2024-09-17 15:03:23">2024-09-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-14T13:29:29.917Z" title="更新于 2025-04-14 21:29:29">2025-04-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为湘潭"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>湘潭</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/"><header><a href="/tags/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/" tabindex="-1" itemprop="url">技术漫谈</a><h1 id="CrawlerTitle" itemprop="name headline">技术漫谈</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">FANSEA</span><time itemprop="dateCreated datePublished" datetime="2024-09-17T07:03:23.000Z" title="发表于 2024-09-17 15:03:23">2024-09-17</time><time itemprop="dateCreated datePublished" datetime="2025-04-14T13:29:29.917Z" title="更新于 2025-04-14 21:29:29">2025-04-14</time></header><h1 id="技术漫谈"><a href="#技术漫谈" class="headerlink" title="技术漫谈"></a>技术漫谈</h1><h2 id="如何解决订单一致性问题"><a href="#如何解决订单一致性问题" class="headerlink" title="如何解决订单一致性问题"></a>如何解决订单一致性问题</h2><blockquote>
<p>Lua + RocketMq事务消息</p>
<ul>
<li>Lua：保障原子性，相比Java事务响应更加快捷</li>
<li>RocketMq：保障消息发送环节的事务性</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage/">事务消息 | RocketMQ (apache.org)</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/tradetrans01-636d42fb6584de6c51692d0889af5c2d.png" alt="tradetrans01-636d42fb6584de6c51692d0889af5c2d"></p>
<h3 id="XA协议"><a href="#XA协议" class="headerlink" title="XA协议"></a>XA协议</h3><ul>
<li><strong>原理</strong>：将四个调用分支封装成包含四个独立事务分支的大事务</li>
<li><strong>特点</strong>：多分支环境下资源锁定范围大，<strong>并发度低</strong>，随着下游分支的增加，系统<strong>性能会越来越差</strong></li>
</ul>
<h3 id="普通消息-订单事务"><a href="#普通消息-订单事务" class="headerlink" title="普通消息+订单事务"></a>普通消息+订单事务</h3><ul>
<li><strong>原理</strong>：基于MQ异步实现事务同步</li>
<li><strong>特点</strong>：并发量大、无法保证最终一致性</li>
</ul>
<blockquote>
<p>该方案中消息下游分支和订单系统变更的主分支很容易出现不一致的现象，例如：</p>
<ul>
<li>消息发送成功，订单没有执行成功，需要回滚整个事务。</li>
<li>订单执行成功，消息没有发送成功，需要额外补偿才能发现不一致。</li>
<li>消息发送超时未知，此时无法判断需要回滚订单还是提交订单变更。</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/transwithnormal-f7d951385520fc18aea8d85f0cd86c27.png" alt="transwithnormal-f7d951385520fc18aea8d85f0cd86c27"></p>
<h3 id="RocketMQ事务消息"><a href="#RocketMQ事务消息" class="headerlink" title="RocketMQ事务消息"></a>RocketMQ事务消息</h3><blockquote>
<p><strong>用于分布式服务间的最终一致性，将消息发送和主事务绑定，解决了普通消息+主事务的结果不一致的问题</strong></p>
<p>上述普通消息方案中，普通消息和订单事务无法保证一致的原因，<strong>本质上是由于普通消息无法像单机数据库事务一样，具备提交、回滚和统一协调的能力</strong>。</p>
<p>而基于Apache RocketMQ实现的分布式事务消息功能，在普通消息基础上，支持二阶段的提交能力。将二阶段提交和本地事务绑定，实现全局提交结果的一致性。</p>
</blockquote>
<ul>
<li><strong>原理</strong>：普通消息+订单事务的基础上对消息发送这个步骤增加事务（事务消息<strong>具备提交、回滚和统一协调的能力</strong>）</li>
<li><strong>特点</strong>：保证并发的同时、并且保证最终一致性</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/tradewithtrans-25be17fcdedb8343a0d2633e693d126d-1726557004247-6.png" alt="tradewithtrans-25be17fcdedb8343a0d2633e693d126d"></p>
<blockquote>
<h4 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h4></blockquote>
<p>Apache RocketMQ 是一款分布式消息中间件，它支持多种消息模式，包括事务消息。事务消息主要用于确保本地事务和消息发送的一致性。下面是一个使用 Java 实现 RocketMQ 事务消息的基本示例。</p>
<p>首先，你需要确保你的环境中已经安装了 RocketMQ 的 Broker 和 NameServer，并且正确配置了环境。</p>
<blockquote>
<h5 id="步骤-1-创建事务生产者"><a href="#步骤-1-创建事务生产者" class="headerlink" title="步骤 1: 创建事务生产者"></a>步骤 1: 创建事务生产者</h5></blockquote>
<p>首先，你需要创建一个 <code>TransactionProducer</code> 实例，并设置一个 <code>executeLocalTransactionBranch</code> 方法来处理本地事务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.producer.DefaultMQProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.producer.MessageQueueSelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.producer.SendResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.common.message.Message;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.remoting.common.RemotingHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 实例化消息生产者Producer</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;TransactionProducerGroup&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置NameServer的地址</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行本地事务</span></span><br><span class="line">        producer.setTransactionExecutor(<span class="keyword">new</span> <span class="title class_">TransactionMQProducer</span>.TransactionExecutor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransactionBranch</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">                <span class="comment">// 这里处理本地事务逻辑</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="comment">/* 本地事务成功 */</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="comment">/* 需要回滚 */</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动Producer实例</span></span><br><span class="line">        producer.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一条消息对象，这里Hello World为消息内容，TagA为用户指定的标签，test为消息主题</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;TopicTest&quot;</span>, <span class="string">&quot;TagA&quot;</span>, <span class="string">&quot;Hello RocketMQ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">sendResult</span> <span class="operator">=</span> producer.send(msg, <span class="keyword">new</span> <span class="title class_">MessageQueueSelector</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> MessageQueue <span class="title function_">select</span><span class="params">(List&lt;MessageQueue&gt; mqs, Message msg, Object arg)</span> &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> (Long)arg;</span><br><span class="line">                <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (<span class="type">int</span>)(id % mqs.size());</span><br><span class="line">                <span class="keyword">return</span> mqs.get(index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1L</span>); <span class="comment">// arg参数为1</span></span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;%s%n&quot;</span>, sendResult);</span><br><span class="line">        <span class="comment">// 如果不是UNKNOW状态，则不需要回调检查</span></span><br><span class="line">        <span class="keyword">if</span> (sendResult.getSendStatus() == SendStatus.SEND_OK &amp;&amp; sendResult.getLocalTransactionState() != LocalTransactionState.UNKNOW) &#123;</span><br><span class="line">            producer.shutdown();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待Broker的二次确认</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<h5 id="步骤-2-处理事务状态检查"><a href="#步骤-2-处理事务状态检查" class="headerlink" title="步骤 2: 处理事务状态检查"></a>步骤 2: 处理事务状态检查</h5></blockquote>
<p>RocketMQ 的 Broker 会异步地回调 <code>checkLocalTransactionState</code> 方法来确认消息的状态。如果本地事务状态未知，Broker 将会调用这个方法来确认消息是否应该提交还是回滚。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransactionState</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">    <span class="comment">// 这里根据message的属性来决定是否提交或回滚消息</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="comment">/* 本地事务成功 */</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，上述示例代码仅为示意性的，实际使用时需要根据具体的业务逻辑实现 <code>executeLocalTransactionBranch</code> 和 <code>checkLocalTransactionState</code> 方法。此外，还需要确保 <code>TransactionMQProducer</code> 的启动和关闭逻辑正确处理。</p>
<p>在实际部署时，请替换 <code>localhost:9876</code> 为你的 NameServer 地址，并确保 <code>TransactionProducerGroup</code> 名称唯一且符合你的命名规则。</p>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><p>官网：<a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/">https://www.jenkins.io/zh/</a></p>
<blockquote>
<ul>
<li>自动CI&#x2F;CD<ul>
<li>集成多插件满足多种编译需求</li>
<li>支持Git，远程在服务器部署程序</li>
<li>配合Docker实现快速编译</li>
<li>定义任务-远程启动-分布式</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20240930101634234.png" alt="image-20240930101634234"></p>
<h2 id="实时数据更新"><a href="#实时数据更新" class="headerlink" title="实时数据更新"></a>实时数据更新</h2><h3 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h3><p><code>Server-Send Event</code></p>
<p>特点：</p>
<ul>
<li>只支持单向通信</li>
<li>不能发送二进制数据、只能发送UTF-8的数据</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20240930233553366.png" alt="image-20240930233553366"></p>
<h3 id="短轮询"><a href="#短轮询" class="headerlink" title="短轮询"></a>短轮询</h3><blockquote>
<p>不断轮询服务器来获取最新数据</p>
</blockquote>
<h3 id="长轮询"><a href="#长轮询" class="headerlink" title="长轮询"></a>长轮询</h3><blockquote>
<p>一个HTTP请求打到服务器</p>
<ul>
<li>如果数据没有更新，连接会被挂起（Hang住），等待30s如果更新了就返回更新数据</li>
<li>如果数据更新了就直接返回</li>
</ul>
</blockquote>
<p><strong>用途</strong>：消息实时性要求高、数据更新频率不快</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p><strong>特点</strong>：</p>
<ul>
<li><strong>实时性：</strong> 由于WebSocket的持久化连接，它可以实现实时的数据传输，避免了Web应用程序需要不断地发送请求以获取最新数据的情况。</li>
<li><strong>双向通信：</strong> WebSocket协议支持双向通信，这意味着服务器可以主动向客户端发送数据，而不需要客户端发送请求。</li>
<li><strong>减少网络负载：</strong> 由于WebSocket的持久化连接，它可以减少HTTP请求的数量，从而减少了网络负载。</li>
</ul>
<p><strong>使用场景</strong>：</p>
<p>在线聊天</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20240930233744255.png" alt="image-20240930233744255"></p>
<h2 id="JWT登录"><a href="#JWT登录" class="headerlink" title="JWT登录"></a>JWT登录</h2><blockquote>
<h3 id="JWT（JSON-Web-Token）定义"><a href="#JWT（JSON-Web-Token）定义" class="headerlink" title="JWT（JSON Web Token）定义"></a>JWT（JSON Web Token）定义</h3></blockquote>
<p>JWT是一种用于在网络应用间安全地传输信息的标准（RFC 7519）。它是一种轻量级的开放标准，用于在各方之间以安全的方式传输信息。JWT通常用于身份验证和服务之间传递授权信息。JWT由三部分组成：头部（Header）、负载（Payload）以及签名（Signature），这三部分通过点号（<code>.</code>）连接。</p>
<blockquote>
<h3 id="JWT的优点"><a href="#JWT的优点" class="headerlink" title="JWT的优点"></a>JWT的优点</h3></blockquote>
<ul>
<li><strong>无状态</strong>：JWT包含所有用户认证信息，因此不需要存储在服务器端，使得其成为无状态的，可以跨域使用。</li>
<li><strong>紧凑性</strong>：JWT是紧凑且自包含的，使得它可以通过URL、POST参数或者在HTTP header中轻松传送。</li>
<li><strong>缓存友好</strong>：因为JWT是无状态的，所以可以被浏览器缓存，而不会带来任何安全隐患。</li>
<li><strong>支持多种加密算法</strong>：JWT支持HMAC算法或RSA公私钥对进行签名。</li>
<li><strong>易于扩展</strong>：可以在JWT中加入任何可序列化为JSON的信息。</li>
</ul>
<blockquote>
<h3 id="JWT的结构原理"><a href="#JWT的结构原理" class="headerlink" title="JWT的结构原理"></a>JWT的结构原理</h3></blockquote>
<p>JWT由以下三部分组成：</p>
<ol>
<li><p><strong>Header（头部）</strong>：<br>头部通常包含了令牌的类型和所使用的签名算法。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Payload（负载）</strong>：<br>负载包含了需要传递的信息。这部分是JWT的核心，也是应用程序想要声明的所有相关信息所在的地方。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;sub&quot;:&quot;1234567890&quot;,&quot;name&quot;:&quot;John Doe&quot;,&quot;iat&quot;:1516239022&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>sub</code> 表示主体，通常是用户ID。</li>
<li><code>name</code> 表示用户的名字。</li>
<li><code>iat</code> 是签发时间，UNIX时间戳格式。</li>
</ul>
</li>
<li><p><strong>Signature（签名）</strong>：</p>
<blockquote>
<p>因为签名的创建是经过负载的，所以在负载内容被篡改时，这会在解析Token时发现签名一定会和负载不对应，导致Token失效</p>
</blockquote>
<p>签名用于验证消息发送者的真实性，并且确保消息没有被篡改。它是通过指定的算法（如 HMAC SHA256）结合Header、Payload以及一个密钥（Secret）计算出来的字符串。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">    base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">    base64UrlEncode(payload),</span><br><span class="line">    secret)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>整个JWT就是将这三部分用<code>.</code>连接起来的一个字符串。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></pre></td></tr></table></figure>

<p>这个字符串分为三个部分：头部、负载、签名。</p>
<p><strong>创建：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateToken</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> Keys.hmacShaKeyFor(<span class="string">&quot;fanseafanseafanseafanseafanseafansesafansea&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(createToken());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setSubject(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .claim(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;fansea&quot;</span>)</span><br><span class="line">                .signWith(key)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解析：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnalysisToken</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> CreateToken.createToken();</span><br><span class="line">        System.out.println(token);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> AnalysisToken.analysisToken(token);</span><br><span class="line">        System.out.println(<span class="string">&quot;Subject:&quot;</span> + claims.getSubject());</span><br><span class="line">        System.out.println(<span class="string">&quot;UserName:&quot;</span> + claims.get(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Claims <span class="title function_">analysisToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> CreateToken.key;</span><br><span class="line">        <span class="keyword">return</span> Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(key)</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(token)</span><br><span class="line">                .getBody();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3></blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241008200934419.png" alt="image-20241008200934419"></p>
<ol>
<li><strong>创建令牌</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">createToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> IdUtils.fastUUID();</span><br><span class="line">    loginUser.setToken(token);</span><br><span class="line">    setUserAgent(loginUser);</span><br><span class="line">    refreshToken(loginUser);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.put(Constants.LOGIN_USER_KEY, token);</span><br><span class="line">    <span class="keyword">return</span> createToken(claims);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, secret).compact();</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserAgent</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">UserAgent</span> <span class="variable">userAgent</span> <span class="operator">=</span> UserAgent.parseUserAgentString(ServletUtils.getRequest().getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> IpUtils.getIpAddr();</span><br><span class="line">        loginUser.setIpaddr(ip);</span><br><span class="line">        loginUser.setLoginLocation(AddressUtils.getRealAddressByIP(ip));</span><br><span class="line">        loginUser.setBrowser(userAgent.getBrowser().getName());</span><br><span class="line">        loginUser.setOs(userAgent.getOperatingSystem().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refreshToken</span><span class="params">(LoginUser loginUser)</span></span><br><span class="line">    &#123;</span><br><span class="line">        loginUser.setLoginTime(System.currentTimeMillis());</span><br><span class="line">        loginUser.setExpireTime(loginUser.getLoginTime() + expireTime * MILLIS_MINUTE);</span><br><span class="line">        <span class="comment">// 根据uuid将loginUser缓存</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(loginUser.getToken());</span><br><span class="line">        redisCache.setCacheObject(userKey, loginUser, expireTime, TimeUnit.MINUTES);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>解析令牌</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">(HttpServletRequest request)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取请求携带的令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getToken(request);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseToken(token);</span><br><span class="line">                <span class="comment">// 解析对应的权限以及用户信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> (String) claims.get(Constants.LOGIN_USER_KEY);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> getTokenKey(uuid);</span><br><span class="line">                <span class="type">LoginUser</span> <span class="variable">user</span> <span class="operator">=</span> redisCache.getCacheObject(userKey);</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                log.error(<span class="string">&quot;获取用户信息异常&#x27;&#123;&#125;&#x27;&quot;</span>, e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="程序设计六大设计原则"><a href="#程序设计六大设计原则" class="headerlink" title="程序设计六大设计原则"></a>程序设计六大设计原则</h2><p>在软件工程中，有多个设计原则用于指导开发者编写<strong>可维护、可扩展、健壮</strong>的代码。虽然不同文献和实践者可能会有所差异，但通常提到的“六大设计原则”指的是面向对象设计的SOLID原则。这些原则有助于避免<strong>代码僵化、脆弱、难以理解</strong>等问题，使软件系统更加灵活、易于维护和扩展。</p>
<blockquote>
<p>程序设计的六大原则必要性：一者在团队协作下编写<strong>可读性</strong>代码尤为重要，二来<strong>方便代码扩展</strong></p>
</blockquote>
<p>以下是SOLID原则的具体内容：</p>
<ol>
<li><p><strong>单一职责原则（Single Responsibility Principle, SRP）</strong></p>
<ul>
<li>每个类应该只有一个改变的理由。这意味着一个类应该只负责一项功能，这样当需求变化时，只需修改一个类即可。</li>
</ul>
</li>
<li><p><strong>开放封闭原则（Open&#x2F;Closed Principle, OCP）</strong></p>
<ul>
<li>软件实体（类、模块、函数等）应该是可扩展的，但不可修改的。也就是说，可以通过添加新的代码来扩展一个模块的功能，而不应当修改已有的代码。</li>
</ul>
</li>
<li><p><strong>里氏替换原则（Liskov Substitution Principle, LSP）</strong></p>
<ul>
<li>子类必须能够替换掉它们的基类。简单来说，就是任何可以使用父类的地方，也应该能够使用子类而不会导致错误。</li>
</ul>
</li>
<li><p><strong>接口隔离原则（Interface Segregation Principle, ISP）</strong></p>
<ul>
<li>使用者不应该被强迫依赖于它们不使用的方法。也就是说，应该将接口设计得足够具体，使得实现类不需要实现不相关的功能。</li>
</ul>
</li>
<li><p><strong>依赖倒置原则（Dependency Inversion Principle, DIP）</strong></p>
<ul>
<li>高层模块不应该依赖于低层模块，二者都应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。</li>
</ul>
<blockquote>
<p>依赖于抽象，便于未来扩展新功能</p>
</blockquote>
</li>
<li><p><strong>迪米特法则（Law of Demeter, LoD）</strong></p>
<ul>
<li>有时也被认为是一个设计原则，它指出一个对象应该对其它对象有最少的了解。即一个对象应当对其它对象有尽可能少的引用，这样可以降低对象之间的耦合度。</li>
</ul>
</li>
</ol>
<h3 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h3><p>依赖倒置原则（Dependency Inversion Principle, DIP）强调高层模块不应该依赖于低层模块，二者都应该依赖于抽象；抽象不应该依赖于细节，细节应该依赖于抽象。通俗地说，就是鼓励我们通过接口或抽象类来编程，而不是针对具体的实现类编程。</p>
<p>为了更好地理解依赖倒置原则，让我们来看一个简单的例子：</p>
<blockquote>
<h4 id="示例背景"><a href="#示例背景" class="headerlink" title="示例背景"></a>示例背景</h4></blockquote>
<p>假设我们需要开发一个系统，其中包括一个用户界面（UI）和一个数据处理逻辑。用户界面需要显示一些数据，而数据处理逻辑负责获取数据并进行处理。</p>
<blockquote>
<h4 id="传统方式"><a href="#传统方式" class="headerlink" title="传统方式"></a>传统方式</h4></blockquote>
<p>传统的方式可能是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataFetcher</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟从网络获取数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Some data&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UI</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DataFetcher</span> <span class="variable">fetcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataFetcher</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> fetcher.fetchData();</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying data: &quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>UI</code> 类直接依赖于 <code>DataFetcher</code> 类。这种方式的问题是，如果 <code>DataFetcher</code> 发生了变化，那么 <code>UI</code> 也需要随之改变。此外，如果我们想要测试 <code>UI</code> 类，就必须有一个实际的 <code>DataFetcher</code> 实例，这增加了测试的难度。</p>
<blockquote>
<h4 id="应用依赖倒置原则"><a href="#应用依赖倒置原则" class="headerlink" title="应用依赖倒置原则"></a>应用依赖倒置原则</h4></blockquote>
<p>现在，我们应用依赖倒置原则，将具体的实现转为依赖抽象：</p>
<ol>
<li><strong>定义一个接口或抽象类</strong>，表示数据获取的行为。</li>
<li><strong>高层模块（UI）依赖这个接口</strong>，而不是具体的实现。</li>
<li><strong>低层模块（DataFetcher）实现这个接口</strong>。</li>
</ol>
<p>下面是改进后的代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个数据获取行为的接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IDataFetcher</span> &#123;</span><br><span class="line">    String <span class="title function_">fetchData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的数据获取实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">IDataFetcher</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟从网络获取数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Some data from the network&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDataFetcher</span> <span class="keyword">implements</span> <span class="title class_">IDataFetcher</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fetchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟从文件读取数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Some data from a file&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UI</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IDataFetcher dataFetcher;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过构造函数传递依赖</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UI</span><span class="params">(IDataFetcher dataFetcher)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataFetcher = dataFetcher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> dataFetcher.fetchData();</span><br><span class="line">        System.out.println(<span class="string">&quot;Displaying data: &quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>UI</code> 类依赖于 <code>IDataFetcher</code> 接口，而具体的实现类如 <code>NetworkDataFetcher</code> 或 <code>FileDataFetcher</code> 则实现了这个接口。这种设计的好处是：</p>
<ul>
<li><code>UI</code> 类不关心具体的数据来源，只需要知道如何获取数据。</li>
<li>如果需要更改数据源，只需要更换 <code>IDataFetcher</code> 的实现类。</li>
<li>测试变得更加容易，可以通过构造函数传递一个模拟的 <code>IDataFetcher</code> 实现来进行单元测试。</li>
</ul>
<p>通过这个例子可以看出，依赖倒置原则通过依赖抽象，减少了各个组件间的耦合性，提高了系统的灵活性和可测试性。</p>
<h3 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h3><p>接口隔离原则（Interface Segregation Principle, ISP）提倡的是不应该强迫类去实现它们不需要的方法。换句话说，一个类不应该被迫实现它不会使用的所有接口方法。<strong>ISP 主张将胖接口拆分成更细粒度的接口，以便实现类只需要实现它们真正关心的部分</strong>。</p>
<p>下面通过一个简单的 Java 示例来说明接口隔离原则的重要性及其应用。</p>
<blockquote>
<h4 id="示例背景-1"><a href="#示例背景-1" class="headerlink" title="示例背景"></a>示例背景</h4></blockquote>
<p>假设我们正在开发一个游戏系统，其中包含动物（Animal）和飞行器（Vehicle）两种类型的对象。每种对象都有它们独特的功能。</p>
<blockquote>
<h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4></blockquote>
<p>在没有应用 ISP 的情况下，我们可能会有这样的设计：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IMoveable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>; <span class="comment">// 飞行能力</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">()</span>; <span class="comment">// 游泳能力</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> <span class="keyword">implements</span> <span class="title class_">IMoveable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal is moving.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal cannot fly.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal cannot swim.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> <span class="keyword">implements</span> <span class="title class_">IMoveable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Vehicle is moving.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Vehicle can fly.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Vehicle cannot swim.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个设计中，<code>Animal</code> 类并不支持飞行和游泳，但是由于 <code>IMoveable</code> 接口中定义了这些方法，所以 <code>Animal</code> 类必须实现它们。即使 <code>Animal</code> 类在实现这些方法时仅仅打印出不支持的消息，这也违反了 ISP 的精神。</p>
<blockquote>
<h4 id="应用-ISP-的解决方案"><a href="#应用-ISP-的解决方案" class="headerlink" title="应用 ISP 的解决方案"></a>应用 ISP 的解决方案</h4></blockquote>
<p>按照 ISP 的原则，我们应该将接口拆分为更具体的接口，让类只实现它们实际需要的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IMovable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IFlyable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ISwimmable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> <span class="keyword">implements</span> <span class="title class_">IMovable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Animal is moving.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingVehicle</span> <span class="keyword">implements</span> <span class="title class_">IMovable</span>, IFlyable &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Flying Vehicle is moving.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Flying Vehicle can fly.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SwimmingVehicle</span> <span class="keyword">implements</span> <span class="title class_">IMovable</span>, ISwimmable &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Swimming Vehicle is moving.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swim</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Swimming Vehicle can swim.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个改进的设计中：</p>
<ul>
<li><code>Animal</code> 类只需要实现 <code>IMovable</code> 接口。</li>
<li><code>FlyingVehicle</code> 类实现了 <code>IMovable</code> 和 <code>IFlyable</code> 接口。</li>
<li><code>SwimmingVehicle</code> 类实现了 <code>IMovable</code> 和 <code>ISwimmable</code> 接口。</li>
</ul>
<p>这样，每种类型的对象都只实现了它们实际需要的方法，从而避免了不必要的方法实现，提高了代码的清晰度和可维护性。</p>
<h3 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h3><blockquote>
<p>一个类方法调用另外一个类的逻辑，应该对其他实体有最少的了解，这样可以减少耦合性</p>
</blockquote>
<p>迪米特法则（Law of Demeter, LoD），又称为最少知识原则（Least Knowledge Principle, LKP），主张一个软件实体（如类、模块、函数等）<strong>应该对其他实体有最少的了解</strong>。这意味着一个对象应该尽可能减少与其他对象的交互，仅与它的‘朋友’通信。‘朋友’一般是指当前对象的成员变量、参数、返回的对象等。</p>
<p>应用迪米特法则可以减少对象之间的耦合度，提高系统的灵活性和可维护性。</p>
<blockquote>
<h4 id="示例背景-2"><a href="#示例背景-2" class="headerlink" title="示例背景"></a>示例背景</h4></blockquote>
<p>假设我们有一个学校管理系统，需要处理学生、课程和成绩的关系。具体来说，我们需要一个功能来计算学生的总成绩。</p>
<blockquote>
<h4 id="违反迪米特法则的示例"><a href="#违反迪米特法则的示例" class="headerlink" title="违反迪米特法则的示例"></a>违反迪米特法则的示例</h4></blockquote>
<p>首先，我们看看违反迪米特法则的情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Course course;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, Course course)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.course = course;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateTotalScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 直接访问Course内部的Grades</span></span><br><span class="line">        <span class="keyword">return</span> course.getGrades().stream()</span><br><span class="line">                     .mapToDouble(Grade::getScore)</span><br><span class="line">                     .sum();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Course</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Grade&gt; grades;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Course</span><span class="params">(List&lt;Grade&gt; grades)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.grades = grades;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Grade&gt; <span class="title function_">getGrades</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> grades;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Grade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Grade</span><span class="params">(<span class="type">double</span> score)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>Student</code> 类直接访问了 <code>Course</code> 类的内部状态 <code>grades</code>，并且还调用了 <code>Grade</code> 类的方法 <code>getScore()</code>。这样做的问题是 <code>Student</code> 类与 <code>Course</code> 类和 <code>Grade</code> 类耦合得太紧，不利于系统的扩展和维护。</p>
<blockquote>
<h4 id="应用迪米特法则的示例"><a href="#应用迪米特法则的示例" class="headerlink" title="应用迪米特法则的示例"></a>应用迪米特法则的示例</h4></blockquote>
<p>接下来，我们来看看如何通过迪米特法则来优化上述设计：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Course course;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, Course course)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.course = course;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateTotalScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 通过Course的API来获取总分数</span></span><br><span class="line">        <span class="keyword">return</span> course.calculateScores();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Course</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Grade&gt; grades;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Course</span><span class="params">(List&lt;Grade&gt; grades)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.grades = grades;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateScores</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Course内部处理计算逻辑</span></span><br><span class="line">        <span class="keyword">return</span> grades.stream()</span><br><span class="line">                    .mapToDouble(Grade::getScore)</span><br><span class="line">                    .sum();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Grade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Grade</span><span class="params">(<span class="type">double</span> score)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个改进的设计中：</p>
<ul>
<li><code>Student</code> 类不再直接访问 <code>Course</code> 类的内部状态 <code>grades</code>。</li>
<li><code>Student</code> 类通过调用 <code>Course</code> 类的 <code>calculateScores()</code> 方法来获得总分数。</li>
<li><code>Course</code> 类封装了与其内部 <code>Grades</code> 的交互逻辑。</li>
</ul>
<p>通过这种方式，<code>Student</code> 类仅需知道 <code>Course</code> 类提供的公共方法，而不需要了解其内部结构，这就降低了 <code>Student</code> 类与 <code>Course</code> 类之间的耦合度。</p>
<h2 id="保障缓存和数据库一致性"><a href="#保障缓存和数据库一致性" class="headerlink" title="保障缓存和数据库一致性"></a>保障缓存和数据库一致性</h2><p>执行数据更新操作时，就会出现缓存和数据库的一致性问题</p>
<blockquote>
<h3 id="方法一：延迟双删"><a href="#方法一：延迟双删" class="headerlink" title="方法一：延迟双删"></a>方法一：延迟双删</h3></blockquote>
<p>更新时先把缓存删除，并在数据保存在数据库后延时一点时间再把缓存删除，保障最终一致性</p>
<blockquote>
<p>第一次删除保障更新完数据后，这个时候的访问能拿到最新数据，缓存到Redis，而不至于访问到旧的数据，虽然最后这个存在的Redis的Key最后会被延时删除，但是确实保障了这更新期间的一致性</p>
<p>如果没有后面这一步的删除，很可能并发情况下其他线程查询数据将旧数据继续缓存到了Redis</p>
<p>而至于为什么要设置一个延时时间，可以设定可以接受的不一致的时间</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241019195937626.png" alt="image-20241019195937626"></p>
<blockquote>
<h3 id="方法二：更新数据库再删缓存"><a href="#方法二：更新数据库再删缓存" class="headerlink" title="方法二：更新数据库再删缓存"></a>方法二：更新数据库再删缓存</h3></blockquote>
<p>引入MQ避免删除操作万一失败而导致的缓存一致性的问题（重试机制）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241019200848658.png" alt="image-20241019200848658"></p>
<h2 id="ThreadLocal使用原理"><a href="#ThreadLocal使用原理" class="headerlink" title="ThreadLocal使用原理"></a>ThreadLocal使用原理</h2><blockquote>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3></blockquote>
<ul>
<li>由于是key为this所以一个ThreadLocal类只能保存一个数据，不同的ThreadLocal保存不同的信息</li>
<li>Thread内部包含ThreadLocalMap，这是线程间数据隔离的关键</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241020113624656.png" alt="image-20241020113624656"></p>
<blockquote>
<p><em><strong>为什么ThreadLocal要使用弱引用？</strong></em></p>
<p>确保当 <code>ThreadLocal</code> 实例不再被外部强引用时，可以被垃圾回收器回收</p>
<p>在这样的情况下，Entry由于仍然有Map指向它所以不会被GC回收掉，但是此时的Key又为null，所以我们无法访问到这个Value。这就导致了这个Value我们即不能访问到也不能进行回收，此时就造成了Value的内存泄漏。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/5f5159528b5440599645bfa73965b382.png" alt="5f5159528b5440599645bfa73965b382"></p>
</blockquote>
<blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3></blockquote>
<ol>
<li>声明<code>UserHolder</code>保存用户上下文信息，定义方法对<code>ThreadLocal</code>进行增删查</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;UserDTO&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(UserDTO user)</span>&#123;</span><br><span class="line">        tl.set(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDTO <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tl.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>拦截对应请求，通过<code>UserHolder</code>方法去存取用户信息，记得最终要释放掉空间</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/*黑马点评项目中我们将用户信息保存在每一个请求线程ThreadLocal中，这样我们只需要在拦截器中获取用户信息，无需继续访问数据库*/</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        Map&lt;Object, Object&gt; userDtoMap = stringRedisTemplate.opsForHash()</span><br><span class="line">                .entries(<span class="string">&quot;login:token:&quot;</span> + token);</span><br><span class="line">        <span class="keyword">if</span> (userDtoMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userDtoMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//存在，存入threadLocal中</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">//刷新过期时间</span></span><br><span class="line">        stringRedisTemplate.expire(LOGIN_USER + token,<span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//销毁数据，防止用户信息泄露</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3></blockquote>
<p><em><strong>为什么ThreadLocal会有内存泄漏的风险？</strong></em></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/v2-48b3d9946fd8d43a68430c9217813f9a_1440w.png" alt="v2-48b3d9946fd8d43a68430c9217813f9a_1440w"></p>
<p>threadLocalMap使用ThreadLocal的弱引用作为key，如果一个ThreadLocal不存在外部<strong>强引用</strong>时，Key(ThreadLocal)势必会被GC回收，这样就会导致ThreadLocalMap中key为null， 而value还存在着强引用，只有thead线程退出以后,value的强引用链条才会断掉。</p>
<p>但如果当前线程再迟迟不结束的话，这些key为null的Entry的value就会一直存在一条强引用链：</p>
<blockquote>
<p>Thread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value</p>
</blockquote>
<p>永远无法回收，造成内存泄漏</p>
<p><em><strong>为什么<code>ThreadLocalMap</code>中的<code>Entry</code>的<code>key</code>要声明为<code>WeakReference</code>？</strong></em></p>
<p>在线程池中，一个线程会不断的从队列中拿去任务执行（不发生异常的话），这个线程是会一直存活的，换句话说他的ThreadLocalMap一直都在。<br>如果此时ThreadLocal作为run方法里的局部变量，且ThreadLocalMap的key不声明为弱引用（则为硬引用）。run方法跑完，threadLocal被回收，但是线程不会结束（因为是线程池的线程），ThreadLocalMap不会被回收，对应上一步的生成的Entry还是保留在ThreadLocalMap的数组中，只要Thread不死（ThreadLocalMap就还在），GC就无法回收那个Entry(key,value)，然后key不为null，已经没办法判断是不是回收的了。<br>还是讨论ThreadLocal作为run方法里的局部变量，且ThreadLocalMap的key声明为弱引用。run方法跑完，threadLocal被回收，但是线程不会结束（因为是线程池的线程），ThreadLocalMap不会被回收，对应上一步的生成的Entry还是保留在ThreadLocalMap的数组中。等待某次GC后，Entry的key被回收，变成Entry(null,value)，在remove源码中，有对key&#x3D;&#x3D;null的Entry进行value&#x3D;null的help GC的操作。在某次调用remove还能再补救一下，相比为硬引用，已经没办法补救了，已经识别不出来哪些是正在需要GC的了。</p>
<p>总结来说，在ThreadLocal为局部变量的时候，不声明为WeekReference，忘记remove了，然后ThreadLocal被回收后，再也没办法确认ThreadLocalMap这个认为是用完的Entry（key，value）节点是不是可以GC了。而弱引用的Entry的key，某次GC后，无用的Entry都被标记为（null， value），此时就能识别出来是泄露的内存。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> &#123;</span><br><span class="line">    <span class="comment">//使用hash方式，计算当前ThreadLocal变量所在table数组位置</span></span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//再次循环判断是否在为ThreadLocal变量所在table数组位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">         e != <span class="literal">null</span>;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.get() == key) &#123;</span><br><span class="line">            <span class="comment">//调用WeakReference的clear方法清除对ThreadLocal的弱引用</span></span><br><span class="line">            e.clear();</span><br><span class="line">            <span class="comment">//清理key为null的元素</span></span><br><span class="line">            expungeStaleEntry(i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的话无论是UserContextHolder还是TenantContextHolder，只要是key被回收了指向null都会被一次性<code>remove</code>掉</p>
<h2 id="软件开发模型"><a href="#软件开发模型" class="headerlink" title="软件开发模型"></a>软件开发模型</h2><p>在软件工程中，开发模型是用来规划和组织软件开发过程的一组实践和技术。以下是三种常见的软件开发模型：瀑布模型、增量模型和螺旋模型。</p>
<h3 id="1-瀑布模型-Waterfall-Model"><a href="#1-瀑布模型-Waterfall-Model" class="headerlink" title="1. 瀑布模型 (Waterfall Model)"></a>1. 瀑布模型 (Waterfall Model)</h3><p>瀑布模型是最传统的软件开发过程模型之一，它将软件开发过程划分为一系列阶段，每个阶段必须在前一个阶段完成后才能开始。这些阶段通常包括需求分析、设计、编码、测试和维护。</p>
<ul>
<li><p><strong>特点</strong>：</p>
<ul>
<li>阶段性：每个阶段必须完成一定的任务，然后才能进入下一个阶段。</li>
<li>单向流动：一旦进入下一阶段，很难返回上一阶段进行修改。</li>
<li>文档化：每个阶段结束时都需要产生详细的文档。</li>
</ul>
</li>
<li><p><strong>优点</strong>：</p>
<ul>
<li>结构清晰，便于管理和控制。</li>
<li>易于理解，适合小型项目或需求非常明确的项目。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>缺乏灵活性，一旦进入后期阶段，很难回到早期阶段进行修改。</li>
<li>不适合需求不明确或需求频繁变更的项目。</li>
<li>用户参与度较低，直到后期才能看到实际的产品。</li>
</ul>
</li>
</ul>
<h3 id="2-增量模型-Incremental-Model"><a href="#2-增量模型-Incremental-Model" class="headerlink" title="2. 增量模型 (Incremental Model)"></a>2. 增量模型 (Incremental Model)</h3><p>增量模型是瀑布模型的一种改进，它允许在开发过程中逐步交付产品的各个部分或功能模块。</p>
<ul>
<li><p><strong>特点</strong>：</p>
<ul>
<li>分批次开发：将软件开发分解成一系列的增量构建，每次构建都会交付一部分功能。</li>
<li>迭代：每次增量构建都可以基于之前的反馈进行调整。</li>
</ul>
</li>
<li><p><strong>优点</strong>：</p>
<ul>
<li>提高了项目的灵活性，可以在早期阶段就获得用户反馈。</li>
<li>减少了项目的总体风险，因为每次只关注一小部分功能。</li>
<li>更好地适应需求变化。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>管理多个增量版本可能较为复杂。</li>
<li>需要较好的计划和协调能力。</li>
</ul>
</li>
</ul>
<h3 id="3-螺旋模型-Spiral-Model"><a href="#3-螺旋模型-Spiral-Model" class="headerlink" title="3. 螺旋模型 (Spiral Model)"></a>3. 螺旋模型 (Spiral Model)</h3><p>螺旋模型结合了瀑布模型的阶段性和原型模型的迭代性，特别适用于大型复杂系统的开发。</p>
<ul>
<li><p><strong>特点</strong>：</p>
<ul>
<li>迭代循环：每个周期包含四个主要阶段——制定计划、风险评估、工程实施、客户评估。</li>
<li>风险驱动：在每个周期开始时都要进行风险评估，以确定是否继续当前的开发路径。</li>
<li>逐步深入：随着项目的进展，逐步细化需求和解决方案。</li>
</ul>
</li>
<li><p><strong>优点</strong>：</p>
<ul>
<li>能够更好地处理风险，因为每个阶段都包含了风险评估。</li>
<li>更加灵活，允许在项目早期就发现并解决问题。</li>
<li>用户参与度高，每个迭代周期结束后都会有用户评审。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>相对于简单的瀑布模型，管理成本更高。</li>
<li>对于小规模项目来说可能过于复杂。</li>
<li>需要有经验丰富的项目经理来指导风险评估。</li>
</ul>
</li>
</ul>
<p>每种模型都有其适用的场景，选择哪种模型取决于项目的具体情况、团队的经验以及客户的需求。在实际应用中，很多团队会根据项目的特点混合使用多种模型的特点。</p>
<h2 id="分布式理论"><a href="#分布式理论" class="headerlink" title="分布式理论"></a>分布式理论</h2><p>CAP 理论（也称为布鲁尔定理）是由加州大学伯克利分校的计算机科学家埃里克·布鲁尔（Eric Brewer）在2000年提出的。这一理论阐述了分布式系统设计中一致性和可用性之间的权衡。在 CAP 理论中，分布式系统的设计必须在以下三个属性中至少放弃一个：</p>
<ol>
<li><p><strong>一致性（Consistency）</strong>：</p>
<ul>
<li>所有节点在同一时刻看到相同的数据。</li>
<li>一次更新操作后，所有节点要么都显示新数据，要么都显示旧数据，不会出现部分节点显示旧数据，部分节点显示新数据的情况。</li>
<li>更新操作后，系统处于一致状态。</li>
</ul>
</li>
<li><p><strong>可用性（Availability）</strong>：</p>
<ul>
<li>每个请求（无论是否最终成功或失败）都能在合理的时间内收到响应。</li>
<li>系统能够保证非故障节点的请求都能得到响应。</li>
<li>即使有部分节点发生故障，系统仍然能够继续工作。</li>
</ul>
</li>
<li><p><strong>分区容错性（Partition tolerance）</strong>：</p>
<ul>
<li>网络分区（网络的一部分节点无法与其他节点通信）发生时，系统仍然能够正常运作。</li>
<li>即便网络中存在信息丢失或延迟的情况，系统也能继续运作。</li>
</ul>
</li>
</ol>
<p>CAP 理论指出，在分布式系统中，无法同时保证这三个属性。因此，设计者必须在 C、A 和 P 之间做出选择。通常情况下，系统会选择分区容错性（P），因为网络分区是一个不可避免的事实，特别是在互联网环境中。因此，设计者需要在一致性和可用性之间做出权衡。</p>
<blockquote>
<h3 id="CAP-定理的选择示例："><a href="#CAP-定理的选择示例：" class="headerlink" title="CAP 定理的选择示例："></a>CAP 定理的选择示例：</h3></blockquote>
<ul>
<li><p><strong>CA 模型</strong>：</p>
<ul>
<li>当系统没有分区时，保证一致性和可用性。</li>
<li>例如：传统的事务数据库。</li>
</ul>
</li>
<li><p><strong>CP 模型</strong>：</p>
<ul>
<li>在存在分区的情况下，优先保证一致性和分区容错性，可能会牺牲部分可用性。</li>
<li>例如：某些键值存储系统（如 Cassandra 在强一致模式下）。</li>
</ul>
</li>
<li><p><strong>AP 模型</strong>：</p>
<ul>
<li>在存在分区的情况下，优先保证可用性和分区容错性，可能会牺牲一致性。</li>
<li>例如：大多数 NoSQL 数据库（如 Cassandra 在多数情况下）、分布式缓存系统等。</li>
</ul>
</li>
</ul>
<p>在实践中，很多分布式系统会采用混合策略，即在不同的操作或不同的数据类型上采用不同的 CAP 选择，以达到性能和一致性的平衡。此外，一些系统还会使用最终一致性（eventual consistency）的概念，即在一段时间后，所有的数据副本都会达到一致的状态，而不是立即一致。这样可以在一定程度上兼顾可用性和一致性。</p>
<h2 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43530773/article/details/118250152">https://blog.csdn.net/qq_43530773/article/details/118250152</a></p>
<p>UML（Unified Modeling Language，统一建模语言）是一种标准化的通用图形化建模语言，用于软件工程领域。它提供了一套符号体系，使得软件工程师能够以图形化的方式描述、可视化、构造以及记录软件系统的设计。UML 是由 Grady Booch、James Rumbaugh 和 Ivar Jacobson 在 20 世纪 90 年代初开发的，并在 1997 年由 Object Management Group (OMG) 标准化。</p>
<blockquote>
<h3 id="UML-的主要用途："><a href="#UML-的主要用途：" class="headerlink" title="UML 的主要用途："></a>UML 的主要用途：</h3></blockquote>
<ol>
<li><p><strong>描述系统结构</strong>：</p>
<ul>
<li>描述系统的静态结构，包括类、接口、对象以及它们之间的关系。</li>
</ul>
</li>
<li><p><strong>描述系统行为</strong>：</p>
<ul>
<li>描述系统的动态行为，如交互、活动、状态转换等。</li>
</ul>
</li>
<li><p><strong>支持整个软件开发生命周期</strong>：</p>
<ul>
<li>从需求分析到系统维护，UML 支持软件开发的各个阶段。</li>
</ul>
</li>
</ol>
<blockquote>
<h3 id="UML-图的主要类型："><a href="#UML-图的主要类型：" class="headerlink" title="UML 图的主要类型："></a>UML 图的主要类型：</h3></blockquote>
<ol>
<li><p><strong>类图（Class Diagrams）</strong>：</p>
<ul>
<li>用于描述系统的静态结构，包括类、接口、类的关系（如继承、聚合、组合等）。</li>
</ul>
</li>
<li><p><strong>对象图（Object Diagrams）</strong>：</p>
<ul>
<li>展示类实例（对象）及其相互关系。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/ad9744e5852bc983631d46d36cc5a892.png" alt="ad9744e5852bc983631d46d36cc5a892"></p>
</li>
<li><p><strong>组件图（Component Diagrams）</strong>：</p>
<ul>
<li>描述系统中的物理构件（如库、可执行文件、源代码文件等）以及它们之间的依赖关系。</li>
</ul>
</li>
<li><p><strong>部署图（Deployment Diagrams）</strong>：</p>
<ul>
<li>描述系统的硬件架构以及软件构件在硬件上的分布情况。</li>
</ul>
</li>
<li><p><strong>时序图（Sequence Diagrams）</strong>：</p>
<ul>
<li>描述对象之间如何交互以完成特定的用例或功能，强调时间顺序。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/d85dcdd89b4bdc8b2851648e6665c9d4.png" alt="d85dcdd89b4bdc8b2851648e6665c9d4"></p>
</li>
<li><p><strong>协作图（Collaboration Diagrams）</strong>：</p>
<ul>
<li>也称作通信图（Communication Diagrams），展示对象之间的交互，但更注重参与者之间的关系。</li>
</ul>
</li>
<li><p><strong>活动图（Activity Diagrams）</strong>：</p>
<ul>
<li>描述系统的活动流程，类似于流程图，但可以表示并发活动。</li>
</ul>
</li>
<li><p><strong>状态机图（State Machine Diagrams 或 Statechart Diagrams）</strong>：</p>
<ul>
<li>描述对象在其生命周期中的状态变化以及导致这些变化的事件。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/c24882b3404e222a9ff3540f1523a2a9.png" alt="c24882b3404e222a9ff3540f1523a2a9"></p>
</li>
<li><p><strong>用例图（Use Case Diagrams）</strong>：</p>
<ul>
<li>描述系统功能（用例）以及与系统交互的外部参与者（Actor）。</li>
</ul>
</li>
<li><p><strong>包图（Package Diagrams）</strong>：</p>
<ul>
<li>描述系统中逻辑模块（包）及其依赖关系。</li>
</ul>
</li>
</ol>
<blockquote>
<h3 id="UML-的优势："><a href="#UML-的优势：" class="headerlink" title="UML 的优势："></a>UML 的优势：</h3></blockquote>
<ul>
<li><strong>统一性</strong>：提供了一套标准的符号体系，使得不同的开发人员可以共享设计信息。</li>
<li><strong>可读性</strong>：图形化的表示方式使得设计更加直观易懂。</li>
<li><strong>工具支持</strong>：有许多工具支持 UML，如 Eclipse 的 Papyrus、IBM Rational Rose、StarUML 等。</li>
</ul>
<p>UML 是一个强大的工具，它帮助软件工程师在设计阶段就识别出潜在的问题，并促进团队成员之间的沟通。虽然 UML 本身并不能编写代码，但它可以帮助团队更好地理解和实现软件系统。</p>
<h2 id="拦截器与过滤器"><a href="#拦截器与过滤器" class="headerlink" title="拦截器与过滤器"></a>拦截器与过滤器</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>在Java Web开发中，Spring MVC框架提供了两种机制来处理请求之前的逻辑或请求之后的逻辑：过滤器（Filter）和拦截器（Interceptor）。虽然它们都可以用来处理一些预处理或后处理的任务，但是它们的使用场景和实现方式有所不同。</p>
<blockquote>
<h4 id="过滤器-Filter"><a href="#过滤器-Filter" class="headerlink" title="过滤器(Filter)"></a>过滤器(Filter)</h4></blockquote>
<p>过滤器是Servlet规范的一部分，因此它不仅限于Spring MVC使用。过滤器通常用于跨多个Servlet或JSP页面的功能，如编码处理、登录验证、权限检查等。</p>
<ul>
<li><strong>生命周期</strong>：过滤器的生命周期由容器管理，可以对请求进行预处理，在响应返回客户端之前进行后处理。</li>
<li><strong>配置</strong>：过滤器是通过<code>web.xml</code>文件或者使用Java配置类中的<code>@ServletComponentScan</code>注解来配置的。</li>
<li><strong>执行顺序</strong>：过滤器按照在<code>web.xml</code>中的声明顺序执行。</li>
<li><strong>API</strong>：使用<code>javax.servlet.Filter</code>接口实现。</li>
</ul>
<blockquote>
<h4 id="拦截器-Interceptor"><a href="#拦截器-Interceptor" class="headerlink" title="拦截器(Interceptor)"></a>拦截器(Interceptor)</h4></blockquote>
<p>拦截器是Spring MVC框架特有的组件，主要用于拦截用户请求并做相应的处理。拦截器主要用于业务操作前后的处理，如记录日志、性能监控、事务处理、异常处理等。</p>
<ul>
<li><strong>生命周期</strong>：拦截器的生命周期由Spring MVC管理。</li>
<li><strong>配置</strong>：拦截器是通过在Spring MVC的配置类中通过<code>addInterceptors()</code>方法来配置的。</li>
<li><strong>执行顺序</strong>：拦截器的执行顺序取决于你在配置类中定义的顺序。</li>
<li><strong>API</strong>：实现<code>org.springframework.web.servlet.HandlerInterceptor</code>接口或继承<code>HandlerInterceptorAdapter</code>类。</li>
</ul>
<blockquote>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4></blockquote>
<ul>
<li><strong>过滤器</strong>：更适合于做一些通用的功能，比如统一设置<strong>字符编码、增加响应头信息、安全控制</strong>等。（偏向于对请求的基础处理）</li>
<li><strong>拦截器</strong>：适合于做一些业务相关的处理，比如<strong>权限校验、记录日志</strong>等。（更偏向于业务）</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><blockquote>
<h4 id="过滤器示例"><a href="#过滤器示例" class="headerlink" title="过滤器示例"></a>过滤器示例</h4></blockquote>
<p>首先创建一个过滤器类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// 初始化代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 在请求进入Controller之前处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;EncodingFilter: Before processing&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用下一个过滤器或者最终的目标资源</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在请求返回给客户端之后处理</span></span><br><span class="line">        System.out.println(<span class="string">&quot;EncodingFilter: After processing&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 销毁代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<code>web.xml</code>中配置这个过滤器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.example.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="拦截器示例"><a href="#拦截器示例" class="headerlink" title="拦截器示例"></a>拦截器示例</h4></blockquote>
<p>创建一个拦截器类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">extends</span> <span class="title class_">HandlerInterceptorAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 在调用控制器方法之前执行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor: Before processing&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查session中是否有用户信息</span></span><br><span class="line">        <span class="keyword">if</span> (request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果没有，则重定向到登录页面</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 返回true则继续向下执行，否则结束</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 在调用控制器方法之后执行，但在视图渲染之前</span></span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor: After handling but before view rendering&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 在整个请求完成后执行，包括视图渲染</span></span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor: After view rendering&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在Spring MVC配置类中注册这个拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 注册拦截器</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">// 拦截所有请求</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/logout&quot;</span>); <span class="comment">// 排除/login和/logout路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是过滤器和拦截器的基本使用示例。实际应用中可以根据需求调整代码逻辑和配置。</p>
<h2 id="Spring异步流式接口"><a href="#Spring异步流式接口" class="headerlink" title="Spring异步流式接口"></a>Spring异步流式接口</h2><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tDP3Nz2s8ZyuUf13I9Hr9A">Spring异步流式接口详解及使用</a></p>
<blockquote>
<h3 id="ResponseBodyEmitter"><a href="#ResponseBodyEmitter" class="headerlink" title="ResponseBodyEmitter"></a>ResponseBodyEmitter</h3></blockquote>
<p>使用<code>ResponseBodyEmitter</code>来实现下这个效果，创建 ResponseBodyEmitter 发送器对象，模拟耗时操作逐步调用 send 方法发送消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/bodyEmitter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseBodyEmitter <span class="title function_">handle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个ResponseBodyEmitter，-1代表不超时</span></span><br><span class="line">        <span class="type">ResponseBodyEmitter</span> <span class="variable">emitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseBodyEmitter</span>(-<span class="number">1L</span>);</span><br><span class="line">        <span class="comment">// 异步执行耗时操作</span></span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 模拟耗时操作</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;bodyEmitter &quot;</span> + i);</span><br><span class="line">                    <span class="comment">// 发送数据</span></span><br><span class="line">                    emitter.send(<span class="string">&quot;bodyEmitter &quot;</span> + i + <span class="string">&quot; @ &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 完成</span></span><br><span class="line">                emitter.complete();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// 发生异常时结束接口</span></span><br><span class="line">                emitter.completeWithError(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> emitter;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_gif/0OzaL5uW2aPBc1E1o03KEbA2DXxEVodxaOEwibCRwicCiaId25d2oe2xldHs4D8KcUicGzlvNgzRSAL57j2IU80AMw/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1"></p>
<blockquote>
<h3 id="SseEmitter"><a href="#SseEmitter" class="headerlink" title="SseEmitter"></a>SseEmitter</h3></blockquote>
<p><code>SseEmitter</code> 是 <code>ResponseBodyEmitter</code> 的一个子类，它同样能够实现动态内容生成，不过主要将它用在<strong>服务器向客户端</strong>推送实时数据，如实时消息推送、状态更新等场景。</p>
<blockquote>
<h3 id="StreamingResponseBody"><a href="#StreamingResponseBody" class="headerlink" title="StreamingResponseBody"></a>StreamingResponseBody</h3></blockquote>
<p><code>StreamingResponseBody</code> 与其他响应处理方式略有不同，主要用于处理<strong>大数据量</strong>或持续数据流的传输，支持将数据直接写入<code>OutputStream</code>。</p>
<h2 id="Java的NIO详解"><a href="#Java的NIO详解" class="headerlink" title="Java的NIO详解"></a>Java的NIO详解</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/crazymakercircle/article/details/120946903">NIO详解</a></p>
<p><code>NIO</code>是<code>jdk1.4</code>之后<code>对BIO</code>缺点提出的一种替换方案。<code>N</code>为<code>New</code></p>
<p><strong>适用场景</strong>：需要处理大量并发连接的场景、实时数据处理、搭建高性能服务器</p>
<blockquote>
<h3 id="BIO有什么缺点？"><a href="#BIO有什么缺点？" class="headerlink" title="BIO有什么缺点？"></a>BIO有什么缺点？</h3></blockquote>
<p>BIO通常是<strong>对每个连接开辟一个线程</strong>去处理事件，如果没监听到数据将会一直<strong>阻塞</strong></p>
<ul>
<li>线程的创建销毁都需要重量级的操作</li>
<li>多线程之间的并发会带来线程切换的消耗（因为要保存线程的上下文信息）</li>
<li>线程本身占用较大内存，像Java的线程的栈内存，一般至少分配<code>512K～1M</code>的空间，如果系统中的线程数过千，整个JVM的内存将被耗用1G。</li>
</ul>
<blockquote>
<h3 id="如何优化BIO？"><a href="#如何优化BIO？" class="headerlink" title="如何优化BIO？"></a>如何优化BIO？</h3></blockquote>
<p>现实开发中，通常用的最多的也是BIO。为了避免过高并发带来的多线程性能降低，常常会使用线程池来处理任务</p>
<p>但这并不能解决阻塞问题，万一连接了而不发送数据，那还是会占用没必要的线程资源！</p>
<blockquote>
<h3 id="NIO的优化点"><a href="#NIO的优化点" class="headerlink" title="NIO的优化点"></a>NIO的优化点</h3></blockquote>
<p><strong>NIO结构包括</strong>：管道、选择器、缓冲区</p>
<ul>
<li>管道：监听某一个端口的连接与IO（可以理解为当前端口收到了多少个连接就是多少个管道）</li>
<li>选择器：监听每个管道的事件（通过阻塞轮询定位到有数据发送的管道）</li>
<li>缓冲区：缓存读写数据</li>
</ul>
<p>通过管道搭配选择器可以实现多路复用，一个线程监听多个连接，且这是非阻塞的，只有当有数据发送过来才会执行读取逻辑，期间可以利用该线程去做其他的事</p>
<p><strong>优化点</strong>：</p>
<ul>
<li><p><strong>多路复用</strong>：减少线程消耗，最大程度利用好一个线程的资源</p>
</li>
<li><p><strong>非阻塞</strong>：</p>
<blockquote>
<p>BIO的操作是阻塞的，当一个线程调用read() 或 write()时，该线程被阻塞，直到有一些数据被读取，或数据完全写入。该线程在此期间不能再干任何事情了。例如，我们调用一个read方法读取一个文件的内容，那么调用read的线程会被阻塞住，直到read操作完成。</p>
<p>NIO如何做到非阻塞的呢？当我们调用read方法时，系统底层已经把数据准备好了，应用程序只需要从通道把数据复制到Buffer（缓冲区）就行；如果没有数据，当前线程可以去干别的事情，不需要进行阻塞等待。</p>
</blockquote>
</li>
</ul>
<p><strong>监听事件：</strong></p>
<p>Java NIO将NIO事件进行了简化，只定义了四个事件，这四种事件用SelectionKey的四个常量来表示：</p>
<ul>
<li><p>SelectionKey.OP_CONNECT</p>
</li>
<li><p>SelectionKey.OP_ACCEPT</p>
</li>
<li><p>SelectionKey.OP_READ</p>
</li>
<li><p>SelectionKey.OP_WRITE</p>
</li>
</ul>
<blockquote>
<h3 id="NIO使用样例"><a href="#NIO使用样例" class="headerlink" title="NIO使用样例"></a>NIO使用样例</h3></blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241102213455125.png" alt="image-20241102213455125"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplexingServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 创建 Selector</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 ServerSocketChannel 并绑定到指定端口</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8080</span>));</span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册 ServerSocketChannel 到 Selector 上，监听 Accept 事件</span></span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Server started on port 8080&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 选择一组已经就绪的通道</span></span><br><span class="line">            selector.select();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取已选择的键集</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; keys = selector.selectedKeys().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (keys.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keys.next();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 处理 Accept 事件</span></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    <span class="type">ServerSocketChannel</span> <span class="variable">serverChannel</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverChannel.accept();</span><br><span class="line">                    socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    <span class="comment">// 读状态：将管道的数据写到缓冲区之后再执行读操作（先写再读）</span></span><br><span class="line">                    socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Accepted connection from &quot;</span> + socketChannel.getRemoteAddress());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 处理 Read 事件</span></span><br><span class="line">                <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(buffer);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// 客户端关闭连接</span></span><br><span class="line">                        socketChannel.close();</span><br><span class="line">                        System.out.println(<span class="string">&quot;Connection closed by client: &quot;</span> + socketChannel.getRemoteAddress());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 将缓冲区切换到读模式</span></span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.remaining()];</span><br><span class="line">                        buffer.get(data);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(data).trim();</span><br><span class="line">                        System.out.println(<span class="string">&quot;Received message from &quot;</span> + socketChannel.getRemoteAddress() + <span class="string">&quot;: &quot;</span> + message);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 回应客户端</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;Echo: &quot;</span> + message;</span><br><span class="line">                        buffer.clear();</span><br><span class="line">                        buffer.put(response.getBytes());</span><br><span class="line">                        buffer.flip(); <span class="comment">//切换回写状态</span></span><br><span class="line">                        socketChannel.write(buffer);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 移除已处理的键</span></span><br><span class="line">                keys.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="CRM系统"><a href="#CRM系统" class="headerlink" title="CRM系统"></a>CRM系统</h2><blockquote>
<p><strong>面向客户，作用企业</strong></p>
<p>总的来说就是通过对客户的信息管理、分析，从而制定个性化营销方案，更好的满足客户需求</p>
</blockquote>
<p>客户关系管理<code>Customer Relationship Management</code></p>
<p>客户关系管理 (CRM) 是指用于管理客户关系的全方位软件系统，而不是一个单独的解决方案。为了有效地管理、分析和改善客户关系，您需要一整套全面的云技术解决方案来帮助企业处理每一个客户交互点。</p>
<p>CRM 系统可收集、关联和分析所有相关客户数据，包括联系人信息、与企业销售代表的<strong>互动信息、历史购买记录、服务请求、资产和报价&#x2F;提议</strong>等。然后用户可访问这些数据，并了解每个接触点的最新动态，并据此创建完整的客户档案，进而建立牢固的客户关系。</p>
<h2 id="性能指标参数"><a href="#性能指标参数" class="headerlink" title="性能指标参数"></a>性能指标参数</h2><blockquote>
<h3 id="吞吐量衡量单位（-s）"><a href="#吞吐量衡量单位（-s）" class="headerlink" title="吞吐量衡量单位（&#x2F;s）"></a>吞吐量衡量单位（&#x2F;s）</h3></blockquote>
<ul>
<li><strong>每秒查询数（<code>Queries Per Second，QPS</code>）</strong>：每秒查询率</li>
<li><strong>每秒请求数（<code>Requests Per Second, RPS</code>）</strong>：在Web服务和API接口中，吞吐量通常表示为每秒钟能够处理的请求数。</li>
<li><strong>每秒事务数（<code>Transactions Per Second, TPS</code>）</strong>：在数据库和金融系统中，吞吐量通常表示为每秒钟能够处理的事务数。</li>
<li><strong>每秒消息数（<code>Messages Per Second, MPS</code>）</strong>：在消息队列和消息传递系统中，吞吐量通常表示为每秒钟能够处理的消息数。</li>
<li><strong>每秒字节数（<code>Bytes Per Second, BPS</code>）</strong>：在网络传输和文件传输中，吞吐量通常表示为每秒钟能够传输的数据量</li>
</ul>
<h2 id="接口限流"><a href="#接口限流" class="headerlink" title="接口限流"></a>接口限流</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luolearn/article/details/120668323">https://blog.csdn.net/luolearn/article/details/120668323</a></p>
<h2 id="如何设计一个高并发处理系统"><a href="#如何设计一个高并发处理系统" class="headerlink" title="如何设计一个高并发处理系统"></a>如何设计一个高并发处理系统</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111203255564.png" alt="image-20241111203255564"></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1BQS2YtEZ5/?spm_id_from=333.1007.tianma.1-2-2.click&vd_source=70a5c913e74574ad96afc2ae210ba3e0">https://www.bilibili.com/video/BV1BQS2YtEZ5/?spm_id_from=333.1007.tianma.1-2-2.click&amp;vd_source=70a5c913e74574ad96afc2ae210ba3e0</a></p>
<ol>
<li><p>系统拆分：拆分服务，并把服务部署集群，通过负载均衡对流量进行分发</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111203653109.png" alt="image-20241111203653109"></p>
</li>
<li><p>缓存加速：缓存热点数据，减少数据库的直接读取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111203854228.png" alt="image-20241111203854228"></p>
</li>
<li><p>MQ异步&#x2F;削峰：异步处理，加快响应时间，削峰填谷</p>
<blockquote>
<p>消费者可以灵活调节，发现业务请求多了可以多添加实例，少了可以减少</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111204039598.png" alt="image-20241111204039598"></p>
</li>
<li><p>数据分离：分库分表，垂直分库减少连接数，水平分表，减少数据库大表拆成小表，数据减少加快索引查询</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111204256453.png" alt="image-20241111204256453"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111204338701.png" alt="image-20241111204338701"></p>
</li>
<li><p>读写分离：读写互斥会降低可用性，将数据读写分离保障最终一致性的同时，加快响应时间。适合读多写少的场景</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111204433580.png" alt="image-20241111204433580"></p>
</li>
<li><p>服务监控：监控服务状态，快速定位服务问题</p>
<blockquote>
<p>Kafaka很适合做日志的消息队列</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20241111204705872.png" alt="image-20241111204705872"></p>
</li>
</ol>
<h2 id="后台快速开发框架"><a href="#后台快速开发框架" class="headerlink" title="后台快速开发框架"></a>后台快速开发框架</h2><ol>
<li><p>若依</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/1024-lab/smart-admin">SmartAdmin</a></p>
<blockquote>
<p>适用于国企、政府类项目，基于SpringBoot+Vue3，打造简洁高效的开发体验！国产加解密技术，国家三级等保</p>
</blockquote>
</li>
</ol>
<h2 id="电脑如何启动"><a href="#电脑如何启动" class="headerlink" title="电脑如何启动"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mm4y1u7G6/?spm_id_from=333.337.search-card.all.click&vd_source=70a5c913e74574ad96afc2ae210ba3e0">电脑如何启动</a></h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20250321153341977.png" alt="image-20250321153341977"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20250321153046153.png" alt="image-20250321153046153"></p>
<h2 id="库存管理"><a href="#库存管理" class="headerlink" title="库存管理"></a>库存管理</h2><p><strong>智能化、协同化、数字化</strong></p>
<ol>
<li><p>与供应商信息共享</p>
<blockquote>
<p>获取最新的产品生产计划，灵活调整补货策略</p>
</blockquote>
</li>
<li><p>大数据分析未来需求</p>
</li>
<li><p>全国仓储网络，多仓协同</p>
<blockquote>
<p>缺货可以迅速从其他地区调拨库存，同时减低库存压力</p>
</blockquote>
</li>
<li><p>线上与线下融合，增快供货速率提升用户体验</p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../image/image-20250328222428022.png" alt="image-20250328222428022"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/fansea.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/fansea.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">FANSEA</div><div class="post-copyright__author_desc">目标明确，只管去做</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/')">技术漫谈</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=技术漫谈&amp;url=https://fansea0.github.io/2024/09/17/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://fansea0.github.io" target="_blank">FANSEA</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>技术漫谈<span class="tagsPageCount">21</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/fansea.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/14/%E7%AE%97%E6%B3%95%E7%AA%81%E7%A0%B4%E8%AE%A1%E5%88%92/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">算法突破计划</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/26/RocketMq/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RocketMq</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/06/01/Caffenie/" title="Caffenie"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-01</div><div class="title">Caffenie</div></div></a></div><div><a href="/2022/12/02/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Git学习笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-02</div><div class="title">Git学习笔记</div></div></a></div><div><a href="/2024/08/23/Gradle/" title="Gradle"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-08-23</div><div class="title">Gradle</div></div></a></div><div><a href="/2024/07/16/MQ%E6%80%9D%E8%80%83%E4%B8%8E%E6%80%BB%E7%BB%93/" title="MQ思考与总结"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-16</div><div class="title">MQ思考与总结</div></div></a></div><div><a href="/2024/07/18/MaxKB-%E5%8D%93%E8%B6%8A%E7%9A%84AI%E9%A9%B1%E5%8A%A8%E7%9F%A5%E8%AF%86%E5%BA%93%E6%9E%84%E5%BB%BA%E4%B8%8E%E4%BC%98%E5%8C%96%E5%B9%B3%E5%8F%B0/" title="MaxKB:卓越的AI驱动知识库构建与优化平台"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-18</div><div class="title">MaxKB:卓越的AI驱动知识库构建与优化平台</div></div></a></div><div><a href="/2023/12/10/OAuth2%E7%99%BB%E5%BD%95%E5%8D%8F%E8%AE%AE/" title="OAuth2登录协议"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-12-10</div><div class="title">OAuth2登录协议</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/fansea.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88"><span class="toc-number">1.</span> <span class="toc-text">技术漫谈</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%AE%A2%E5%8D%95%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">如何解决订单一致性问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">XA协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E6%B6%88%E6%81%AF-%E8%AE%A2%E5%8D%95%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.1.2.</span> <span class="toc-text">普通消息+订单事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RocketMQ%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"><span class="toc-number">1.1.3.</span> <span class="toc-text">RocketMQ事务消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">使用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1-%E5%88%9B%E5%BB%BA%E4%BA%8B%E5%8A%A1%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.1.3.1.1.</span> <span class="toc-text">步骤 1: 创建事务生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2-%E5%A4%84%E7%90%86%E4%BA%8B%E5%8A%A1%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="toc-number">1.1.3.1.2.</span> <span class="toc-text">步骤 2: 处理事务状态检查</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins"><span class="toc-number">1.2.</span> <span class="toc-text">Jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">1.3.</span> <span class="toc-text">实时数据更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSE"><span class="toc-number">1.3.1.</span> <span class="toc-text">SSE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E8%BD%AE%E8%AF%A2"><span class="toc-number">1.3.2.</span> <span class="toc-text">短轮询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%BF%E8%BD%AE%E8%AF%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">长轮询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSocket"><span class="toc-number">1.3.4.</span> <span class="toc-text">WebSocket</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWT%E7%99%BB%E5%BD%95"><span class="toc-number">1.4.</span> <span class="toc-text">JWT登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%EF%BC%88JSON-Web-Token%EF%BC%89%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">JWT（JSON Web Token）定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">JWT的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E7%9A%84%E7%BB%93%E6%9E%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.3.</span> <span class="toc-text">JWT的结构原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.4.</span> <span class="toc-text">代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.5.</span> <span class="toc-text">程序设计六大设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-number">1.5.1.</span> <span class="toc-text">依赖倒置原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E8%83%8C%E6%99%AF"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">示例背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">传统方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">应用依赖倒置原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99"><span class="toc-number">1.5.2.</span> <span class="toc-text">接口隔离原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E8%83%8C%E6%99%AF-1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">示例背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">问题描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8-ISP-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">应用 ISP 的解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99"><span class="toc-number">1.5.3.</span> <span class="toc-text">迪米特法则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E8%83%8C%E6%99%AF-2"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">示例背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9D%E5%8F%8D%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">违反迪米特法则的示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">应用迪米特法则的示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E9%9A%9C%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">1.6.</span> <span class="toc-text">保障缓存和数据库一致性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E5%BB%B6%E8%BF%9F%E5%8F%8C%E5%88%A0"><span class="toc-number">1.6.1.</span> <span class="toc-text">方法一：延迟双删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%8D%E5%88%A0%E7%BC%93%E5%AD%98"><span class="toc-number">1.6.2.</span> <span class="toc-text">方法二：更新数据库再删缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ThreadLocal%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">ThreadLocal使用原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">1.7.3.</span> <span class="toc-text">思考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.8.</span> <span class="toc-text">软件开发模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%80%91%E5%B8%83%E6%A8%A1%E5%9E%8B-Waterfall-Model"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. 瀑布模型 (Waterfall Model)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A2%9E%E9%87%8F%E6%A8%A1%E5%9E%8B-Incremental-Model"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. 增量模型 (Incremental Model)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%9E%BA%E6%97%8B%E6%A8%A1%E5%9E%8B-Spiral-Model"><span class="toc-number">1.8.3.</span> <span class="toc-text">3. 螺旋模型 (Spiral Model)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA"><span class="toc-number">1.9.</span> <span class="toc-text">分布式理论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CAP-%E5%AE%9A%E7%90%86%E7%9A%84%E9%80%89%E6%8B%A9%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.9.1.</span> <span class="toc-text">CAP 定理的选择示例：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UML%E5%9B%BE"><span class="toc-number">1.10.</span> <span class="toc-text">UML图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UML-%E7%9A%84%E4%B8%BB%E8%A6%81%E7%94%A8%E9%80%94%EF%BC%9A"><span class="toc-number">1.10.1.</span> <span class="toc-text">UML 的主要用途：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UML-%E5%9B%BE%E7%9A%84%E4%B8%BB%E8%A6%81%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="toc-number">1.10.2.</span> <span class="toc-text">UML 图的主要类型：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UML-%E7%9A%84%E4%BC%98%E5%8A%BF%EF%BC%9A"><span class="toc-number">1.10.3.</span> <span class="toc-text">UML 的优势：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E4%B8%8E%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text">拦截器与过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">1.11.1.</span> <span class="toc-text">区别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8-Filter"><span class="toc-number">1.11.1.1.</span> <span class="toc-text">过滤器(Filter)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8-Interceptor"><span class="toc-number">1.11.1.2.</span> <span class="toc-text">拦截器(Interceptor)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.11.1.3.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.2.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">过滤器示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">拦截器示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E5%BC%82%E6%AD%A5%E6%B5%81%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.12.</span> <span class="toc-text">Spring异步流式接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseBodyEmitter"><span class="toc-number">1.12.1.</span> <span class="toc-text">ResponseBodyEmitter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SseEmitter"><span class="toc-number">1.12.2.</span> <span class="toc-text">SseEmitter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StreamingResponseBody"><span class="toc-number">1.12.3.</span> <span class="toc-text">StreamingResponseBody</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E7%9A%84NIO%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.13.</span> <span class="toc-text">Java的NIO详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BIO%E6%9C%89%E4%BB%80%E4%B9%88%E7%BC%BA%E7%82%B9%EF%BC%9F"><span class="toc-number">1.13.1.</span> <span class="toc-text">BIO有什么缺点？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96BIO%EF%BC%9F"><span class="toc-number">1.13.2.</span> <span class="toc-text">如何优化BIO？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NIO%E7%9A%84%E4%BC%98%E5%8C%96%E7%82%B9"><span class="toc-number">1.13.3.</span> <span class="toc-text">NIO的优化点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NIO%E4%BD%BF%E7%94%A8%E6%A0%B7%E4%BE%8B"><span class="toc-number">1.13.4.</span> <span class="toc-text">NIO使用样例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRM%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.14.</span> <span class="toc-text">CRM系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E5%8F%82%E6%95%B0"><span class="toc-number">1.15.</span> <span class="toc-text">性能指标参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%9E%E5%90%90%E9%87%8F%E8%A1%A1%E9%87%8F%E5%8D%95%E4%BD%8D%EF%BC%88-s%EF%BC%89"><span class="toc-number">1.15.1.</span> <span class="toc-text">吞吐量衡量单位（&#x2F;s）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81"><span class="toc-number">1.16.</span> <span class="toc-text">接口限流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E9%AB%98%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.17.</span> <span class="toc-text">如何设计一个高并发处理系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="toc-number">1.18.</span> <span class="toc-text">后台快速开发框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B5%E8%84%91%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8"><span class="toc-number">1.19.</span> <span class="toc-text">电脑如何启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.20.</span> <span class="toc-text">库存管理</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/06/cursor%E5%89%8D%E7%AB%AF%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B/" title="cursor前端提示词工程">cursor前端提示词工程</a><time datetime="2025-05-06T03:22:03.000Z" title="发表于 2025-05-06 11:22:03">2025-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/20/%E7%94%B5%E5%95%86%E9%A2%86%E5%9F%9FRAG%E5%AE%A2%E6%9C%8D%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%AE%BE%E8%AE%A1/" title="电商领域RAG客服聊天机器人设计">电商领域RAG客服聊天机器人设计</a><time datetime="2025-04-20T09:47:57.000Z" title="发表于 2025-04-20 17:47:57">2025-04-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/06/AI%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%AE%BE%E8%AE%A1/" title="AI聊天机器人设计">AI聊天机器人设计</a><time datetime="2025-04-06T06:28:45.000Z" title="发表于 2025-04-06 14:28:45">2025-04-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/03/AI-Learning/" title="AI-Learning">AI-Learning</a><time datetime="2025-04-03T09:04:03.000Z" title="发表于 2025-04-03 17:04:03">2025-04-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/30/Docker%E5%AD%A6%E4%B9%A0/" title="Docker学习">Docker学习</a><time datetime="2025-03-30T06:58:02.000Z" title="发表于 2025-03-30 14:58:02">2025-03-30</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="FANSEA" target="_blank">FANSEA</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>1</sup></a><a href="/tags/MQ/" style="font-size: 0.88rem;">MQ<sup>1</sup></a><a href="/tags/NoSQL/" style="font-size: 0.88rem;">NoSQL<sup>2</sup></a><a href="/tags/ROS/" style="font-size: 0.88rem;">ROS<sup>1</sup></a><a href="/tags/cursor-%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">cursor 前端<sup>1</sup></a><a href="/tags/docker-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">docker 微服务<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>8</sup></a><a href="/tags/rag-%E6%99%BA%E8%83%BD%E5%AE%A2%E6%9C%8D-SpringAI-%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1/" style="font-size: 0.88rem;">rag 智能客服 SpringAI 毕业设计<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/%E5%88%9B%E4%B8%9A/" style="font-size: 0.88rem;">创业<sup>1</sup></a><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">微服务<sup>4</sup></a><a href="/tags/%E6%80%9D%E8%80%83/" style="font-size: 0.88rem;">思考<sup>10</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 0.88rem;">技术<sup>1</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88/" style="font-size: 0.88rem;">技术漫谈<sup>21</sup></a><a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 0.88rem;">摄影<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>6</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>7</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7-JMeter/" style="font-size: 0.88rem;">编程工具 JMeter<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">计算机基础<sup>4</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8E%A7%E5%88%B6/" style="font-size: 0.88rem;">计算机控制<sup>1</sup></a><a href="/tags/%E8%BD%A6%E8%BD%A6/" style="font-size: 0.88rem;">车车<sup>1</sup></a><a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 0.88rem;">金融<sup>2</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 0.88rem;">项目<sup>11</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 FANSEA 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>